<!DOCTYPE html>
<html lang="en"><head>
<script src="part-II_files/libs/clipboard/clipboard.min.js"></script>
<script src="part-II_files/libs/quarto-html/tabby.min.js"></script>
<script src="part-II_files/libs/quarto-html/popper.min.js"></script>
<script src="part-II_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="part-II_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="part-II_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="part-II_files/libs/quarto-html/quarto-syntax-highlighting-0815c480559380816a4d1ea211a47e91.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.7.29">

  <title>Tidymodeling</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="part-II_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="part-II_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="part-II_files/libs/revealjs/dist/theme/quarto-13a620129f9b162607aa967697424fae.css">
  <link href="part-II_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="part-II_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="part-II_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="part-II_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <link href="part-II_files/libs/countdown-0.4.0/countdown.css" rel="stylesheet">
  <script src="part-II_files/libs/countdown-0.4.0/countdown.js"></script>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Tidymodeling</h1>
  <p class="subtitle">Part II</p>

<div class="quarto-title-authors">
</div>

</section>
<section id="tentative-outline-for-part-2" class="slide level2">
<h2>Tentative outline for part 2</h2>
<ul>
<li>Feature engineering with recipes</li>
<li>Model optimization by tuning
<ul>
<li>Grid search</li>
<li>Racing</li>
<li>Iterative methods</li>
</ul></li>
<li>Extras (time permitting)
<ul>
<li>Effect encodings</li>
<li>Case studies</li>
</ul></li>
</ul>
<div class="footer">

</div>
</section>
<section id="lets-install-some-packages" class="slide level2">
<h2>Let’s install some packages</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href=""></a><span class="co"># Packages needed</span></span>
<span id="cb1-2"><a href=""></a>pkgs <span class="ot">&lt;-</span> </span>
<span id="cb1-3"><a href=""></a>  <span class="fu">c</span>(<span class="st">"bonsai"</span>, <span class="st">"Cubist"</span>, <span class="st">"doParallel"</span>, <span class="st">"earth"</span>, <span class="st">"embed"</span>, <span class="st">"finetune"</span>, </span>
<span id="cb1-4"><a href=""></a>    <span class="st">"forested"</span>, <span class="st">"lightgbm"</span>, <span class="st">"lme4"</span>, <span class="st">"parallelly"</span>, <span class="st">"plumber"</span>, <span class="st">"probably"</span>, </span>
<span id="cb1-5"><a href=""></a>    <span class="st">"ranger"</span>, <span class="st">"rpart"</span>, <span class="st">"rpart.plot"</span>, <span class="st">"rules"</span>, <span class="st">"splines2"</span>, <span class="st">"stacks"</span>, </span>
<span id="cb1-6"><a href=""></a>    <span class="st">"text2vec"</span>, <span class="st">"textrecipes"</span>, <span class="st">"tidymodels"</span>, <span class="st">"vetiver"</span>)</span>
<span id="cb1-7"><a href=""></a></span>
<span id="cb1-8"><a href=""></a><span class="fu">install.packages</span>(pkgs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Also, you should install the newest version of the dials package (version 1.3.0). To check this, you can run:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href=""></a>rlang<span class="sc">::</span><span class="fu">check_installed</span>(<span class="st">"dials"</span>, <span class="at">version =</span> <span class="st">"1.3.0"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">

</div>
</section>
<section id="my-versions" class="slide level2">
<h2>My versions</h2>
<p>R version 4.5.0 (2025-04-11), Quarto (1.7.29)</p>
<div class="columns" style="font-size:0.7em;">
<div class="column" style="width:25%;">
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: left;">package</th>
<th style="text-align: left;">version</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">bonsai</td>
<td style="text-align: left;">0.3.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">broom</td>
<td style="text-align: left;">1.0.8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Cubist</td>
<td style="text-align: left;">0.5.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">dials</td>
<td style="text-align: left;">1.4.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">doParallel</td>
<td style="text-align: left;">1.0.17</td>
</tr>
<tr class="even">
<td style="text-align: left;">dplyr</td>
<td style="text-align: left;">1.1.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">earth</td>
<td style="text-align: left;">5.3.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">embed</td>
<td style="text-align: left;">1.1.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">finetune</td>
<td style="text-align: left;">1.2.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Formula</td>
<td style="text-align: left;">1.2-5</td>
</tr>
</tbody>
</table>
</div>
</div>
</div><div class="column" style="width:25%;">
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: left;">package</th>
<th style="text-align: left;">version</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ggplot2</td>
<td style="text-align: left;">3.5.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">lattice</td>
<td style="text-align: left;">0.22-6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lightgbm</td>
<td style="text-align: left;">4.6.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">lme4</td>
<td style="text-align: left;">1.1-37</td>
</tr>
<tr class="odd">
<td style="text-align: left;">modeldata</td>
<td style="text-align: left;">1.4.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">parallelly</td>
<td style="text-align: left;">1.43.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">parsnip</td>
<td style="text-align: left;">1.3.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">plotmo</td>
<td style="text-align: left;">3.6.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">plotrix</td>
<td style="text-align: left;">3.8-4</td>
</tr>
<tr class="even">
<td style="text-align: left;">plumber</td>
<td style="text-align: left;">1.3.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div><div class="column" style="width:25%;">
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: left;">package</th>
<th style="text-align: left;">version</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">probably</td>
<td style="text-align: left;">1.0.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">purrr</td>
<td style="text-align: left;">1.0.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">recipes</td>
<td style="text-align: left;">1.3.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">rsample</td>
<td style="text-align: left;">1.3.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">rules</td>
<td style="text-align: left;">1.0.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">scales</td>
<td style="text-align: left;">1.4.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">splines2</td>
<td style="text-align: left;">0.5.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">stacks</td>
<td style="text-align: left;">1.1.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">text2vec</td>
<td style="text-align: left;">0.6.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">textrecipes</td>
<td style="text-align: left;">1.1.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div><div class="column" style="width:25%;">
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: left;">package</th>
<th style="text-align: left;">version</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">tibble</td>
<td style="text-align: left;">3.2.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">tidymodels</td>
<td style="text-align: left;">1.3.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tidyr</td>
<td style="text-align: left;">1.3.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">tune</td>
<td style="text-align: left;">1.3.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">vetiver</td>
<td style="text-align: left;">0.2.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">workflows</td>
<td style="text-align: left;">1.2.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">workflowsets</td>
<td style="text-align: left;">1.1.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">yardstick</td>
<td style="text-align: left;">1.3.2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div></div>
<div class="footer">

</div>
</section>
<section>
<section id="open-worksheet-1" class="title-slide slide level1 center">
<h1>Open Worksheet 1 📄</h1>
<div class="footer">

</div>
</section>
<section id="hotel-data" class="slide level2">
<h2>Hotel Data <img data-src="hexes/tidymodels.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/dplyr.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "></h2>
<p>We’ll use <a href="https://www.sciencedirect.com/science/article/pii/S2352340918315191">data on hotels</a> to predict the cost of a room.</p>
<p>The <a href="https://modeldata.tidymodels.org/reference/hotel_rates.html">data</a> are in the modeldata package. We’ll sample down the data and refactor some columns:</p>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href=""></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb3-2"><a href=""></a></span>
<span id="cb3-3"><a href=""></a><span class="co"># extra settings: </span></span>
<span id="cb3-4"><a href=""></a><span class="fu">tidymodels_prefer</span>()</span>
<span id="cb3-5"><a href=""></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())</span>
<span id="cb3-6"><a href=""></a><span class="fu">options</span>(</span>
<span id="cb3-7"><a href=""></a>  <span class="at">pillar.advice =</span> <span class="cn">FALSE</span>, </span>
<span id="cb3-8"><a href=""></a>  <span class="at">pillar.min_title_chars =</span> <span class="cn">Inf</span></span>
<span id="cb3-9"><a href=""></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href=""></a><span class="fu">data</span>(hotel_rates)</span>
<span id="cb4-2"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">295</span>)</span>
<span id="cb4-3"><a href=""></a>hotel_rates <span class="ot">&lt;-</span> </span>
<span id="cb4-4"><a href=""></a>  hotel_rates <span class="sc">%&gt;%</span> </span>
<span id="cb4-5"><a href=""></a>  <span class="fu">sample_n</span>(<span class="dv">5000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-6"><a href=""></a>  <span class="fu">arrange</span>(arrival_date) <span class="sc">%&gt;%</span> </span>
<span id="cb4-7"><a href=""></a>  <span class="fu">select</span>(<span class="sc">-</span>arrival_date) <span class="sc">%&gt;%</span> </span>
<span id="cb4-8"><a href=""></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-9"><a href=""></a>    <span class="at">company =</span> <span class="fu">factor</span>(<span class="fu">as.character</span>(company)),</span>
<span id="cb4-10"><a href=""></a>    <span class="at">country =</span> <span class="fu">factor</span>(<span class="fu">as.character</span>(country)),</span>
<span id="cb4-11"><a href=""></a>    <span class="at">agent =</span> <span class="fu">factor</span>(<span class="fu">as.character</span>(agent))</span>
<span id="cb4-12"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div></div>
<div class="footer">

</div>
</section>
<section id="hotel-date-columns" class="slide level2">
<h2>Hotel date columns</h2>
<div class="cell" data-labels="hotel-names">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href=""></a><span class="fu">names</span>(hotel_rates)</span>
<span id="cb5-2"><a href=""></a><span class="co">#&gt;  [1] "avg_price_per_room"             "lead_time"                     </span></span>
<span id="cb5-3"><a href=""></a><span class="co">#&gt;  [3] "stays_in_weekend_nights"        "stays_in_week_nights"          </span></span>
<span id="cb5-4"><a href=""></a><span class="co">#&gt;  [5] "adults"                         "children"                      </span></span>
<span id="cb5-5"><a href=""></a><span class="co">#&gt;  [7] "babies"                         "meal"                          </span></span>
<span id="cb5-6"><a href=""></a><span class="co">#&gt;  [9] "country"                        "market_segment"                </span></span>
<span id="cb5-7"><a href=""></a><span class="co">#&gt; [11] "distribution_channel"           "is_repeated_guest"             </span></span>
<span id="cb5-8"><a href=""></a><span class="co">#&gt; [13] "previous_cancellations"         "previous_bookings_not_canceled"</span></span>
<span id="cb5-9"><a href=""></a><span class="co">#&gt; [15] "reserved_room_type"             "assigned_room_type"            </span></span>
<span id="cb5-10"><a href=""></a><span class="co">#&gt; [17] "booking_changes"                "agent"                         </span></span>
<span id="cb5-11"><a href=""></a><span class="co">#&gt; [19] "company"                        "days_in_waiting_list"          </span></span>
<span id="cb5-12"><a href=""></a><span class="co">#&gt; [21] "customer_type"                  "required_car_parking_spaces"   </span></span>
<span id="cb5-13"><a href=""></a><span class="co">#&gt; [23] "total_of_special_requests"      "arrival_date_num"              </span></span>
<span id="cb5-14"><a href=""></a><span class="co">#&gt; [25] "near_christmas"                 "near_new_years"                </span></span>
<span id="cb5-15"><a href=""></a><span class="co">#&gt; [27] "historical_adr"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">

</div>
</section>
<section id="data-splitting-strategy" class="slide level2">
<h2>Data splitting strategy</h2>

<img data-src="images/initial-split.svg" class="quarto-figure quarto-figure-center r-stretch" style="width:20.0%"><div class="footer">

</div>
</section>
<section id="data-spending" class="slide level2">
<h2>Data Spending <img data-src="hexes/rsample.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<p>Let’s split the data into a training set (75%) and testing set (25%) using stratification:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">4028</span>)</span>
<span id="cb6-2"><a href=""></a>hotel_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(hotel_rates, <span class="at">strata =</span> avg_price_per_room)</span>
<span id="cb6-3"><a href=""></a></span>
<span id="cb6-4"><a href=""></a>hotel_train <span class="ot">&lt;-</span> <span class="fu">training</span>(hotel_split)</span>
<span id="cb6-5"><a href=""></a>hotel_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(hotel_split)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">

</div>
</section>
<section id="your-turn" class="slide level2" data-transition="slide-in">
<h2>Your turn</h2>
<p>Let’s take some time and investigate the <em>training data</em>. The outcome is <code>avg_price_per_room</code>.</p>
<p>Are there any interesting characteristics of the data?</p>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="hotel-investigation" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">−</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
<div class="footer">

</div>
</section></section>
<section>
<section id="feature-engineering" class="title-slide slide level1 center">
<h1>Feature Engineering</h1>
<div class="footer">

</div>
</section>
<section id="working-with-our-predictors" class="slide level2">
<h2>Working with our predictors</h2>
<p>We might want to modify our predictors columns for a few reasons:</p>
<ul>
<li class="fragment">The model requires them in a different format (e.g.&nbsp;<a href="https://aml4td.org/chapters/categorical-predictors.html#sec-indicators">dummy variables</a> for linear regression).</li>
<li class="fragment">The model needs certain data qualities (e.g.&nbsp;same units for K-NN).</li>
<li class="fragment">The outcome is better predicted when one or more columns are transformed in some way (a.k.a “feature engineering”).</li>
</ul>
<div class="fragment">
<p>The first two reasons are fairly predictable (<a href="https://www.tmwr.org/pre-proc-table.html#tab:preprocessing">next page</a>).</p>
<p>The last one depends on your modeling problem.</p>
<div class="footer">

</div>
</div>
</section>
<section id="section" class="slide level2" data-background-iframe="https://www.tmwr.org/pre-proc-table.html#tab:preprocessing">
<h2></h2>
<div class="footer">

</div>
</section>
<section id="what-is-feature-engineering" class="slide level2">
<h2>What is feature engineering?</h2>
<p>Think of a feature as some <em>representation</em> of a predictor that will be used in a model.</p>
<div class="fragment">
<p>Example representations:</p>
<ul>
<li>Interactions</li>
<li>Polynomial expansions/splines</li>
<li>Principal component analysis (PCA) feature extraction</li>
</ul>
<p>There are a lot of examples in <a href="https://bookdown.org/max/FES/"><em>Feature Engineering and Selection</em></a> (FES) and <a href="https://aml4td.org/"><em>Applied Machine Learning for Tabular Data</em></a> (aml4td).</p>
<div class="footer">

</div>
</div>
</section>
<section id="example-dates" class="slide level2">
<h2>Example: Dates</h2>
<p>How can we represent date columns for our model?</p>
<div class="fragment">
<p>When we use a date column in its native format, most models in R convert it to an integer.</p>
</div>
<div class="fragment">
<p>We can re-engineer it as:</p>
<ul>
<li>Days since a reference date</li>
<li>Day of the week</li>
<li>Month</li>
<li>Year</li>
<li>Indicators for holidays</li>
</ul>
<aside class="notes">
<p>The main point is that we try to maximize performance with different versions of the predictors.</p>
<p>Mention that, for the Chicago data, the day or the week features are usually the most important ones in the model.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="footer">

</div>
</div>
</section>
<section id="general-definitions" class="slide level2">
<h2>General definitions <img data-src="hexes/recipes.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<ul>
<li><p><em>Data preprocessing</em> steps allow your model to fit.</p></li>
<li><p><em>Feature engineering</em> steps help the model do the least work to predict the outcome as well as possible.</p></li>
</ul>
<p>The recipes package can handle both!</p>
<aside class="notes">
<p>These terms are often used interchangeably in the ML community but we want to distinguish them.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="footer">

</div>
</section>
<section id="previously---setup" class="slide level2">
<h2>Previously - Setup <img data-src="hexes/tidymodels.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="columns">
<div class="column" style="width:40;">
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href=""></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb7-2"><a href=""></a></span>
<span id="cb7-3"><a href=""></a><span class="co"># Add another package:</span></span>
<span id="cb7-4"><a href=""></a><span class="fu">library</span>(textrecipes)</span>
<span id="cb7-5"><a href=""></a></span>
<span id="cb7-6"><a href=""></a><span class="co"># extra settings: </span></span>
<span id="cb7-7"><a href=""></a><span class="fu">tidymodels_prefer</span>()</span>
<span id="cb7-8"><a href=""></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())</span>
<span id="cb7-9"><a href=""></a><span class="fu">options</span>(</span>
<span id="cb7-10"><a href=""></a>  <span class="at">pillar.advice =</span> <span class="cn">FALSE</span>, </span>
<span id="cb7-11"><a href=""></a>  <span class="at">pillar.min_title_chars =</span> <span class="cn">Inf</span></span>
<span id="cb7-12"><a href=""></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60;">
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href=""></a><span class="fu">data</span>(hotel_rates)</span>
<span id="cb8-2"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">295</span>)</span>
<span id="cb8-3"><a href=""></a>hotel_rates <span class="ot">&lt;-</span> </span>
<span id="cb8-4"><a href=""></a>  hotel_rates <span class="sc">%&gt;%</span> </span>
<span id="cb8-5"><a href=""></a>  <span class="fu">sample_n</span>(<span class="dv">5000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-6"><a href=""></a>  <span class="fu">arrange</span>(arrival_date) <span class="sc">%&gt;%</span> </span>
<span id="cb8-7"><a href=""></a>  <span class="fu">select</span>(<span class="sc">-</span>arrival_date) <span class="sc">%&gt;%</span> </span>
<span id="cb8-8"><a href=""></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-9"><a href=""></a>    <span class="at">company =</span> <span class="fu">factor</span>(<span class="fu">as.character</span>(company)),</span>
<span id="cb8-10"><a href=""></a>    <span class="at">country =</span> <span class="fu">factor</span>(<span class="fu">as.character</span>(country)),</span>
<span id="cb8-11"><a href=""></a>    <span class="at">agent =</span> <span class="fu">factor</span>(<span class="fu">as.character</span>(agent))</span>
<span id="cb8-12"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div></div>
<div class="footer">

</div>
</section>
<section id="previously---data-usage" class="slide level2">
<h2>Previously - Data Usage <img data-src="hexes/rsample.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">4028</span>)</span>
<span id="cb9-2"><a href=""></a>hotel_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(hotel_rates, <span class="at">strata =</span> avg_price_per_room)</span>
<span id="cb9-3"><a href=""></a></span>
<span id="cb9-4"><a href=""></a>hotel_train <span class="ot">&lt;-</span> <span class="fu">training</span>(hotel_split)</span>
<span id="cb9-5"><a href=""></a>hotel_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(hotel_split)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>We’ll go from here and create a set of resamples to use for model assessments.</p>
<div class="footer">

</div>
</section>
<section id="resampling-strategy" class="slide level2">
<h2>Resampling Strategy</h2>

<img data-src="images/10-Fold-CV.svg" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"><div class="footer">

</div>
</section>
<section id="resampling-strategy-1" class="slide level2 annotation">
<h2>Resampling Strategy <img data-src="hexes/rsample.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<p>We’ll use simple 10-fold cross-validation (stratified sampling):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">472</span>)</span>
<span id="cb10-2"><a href=""></a>hotel_rs <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(hotel_train, <span class="at">strata =</span> avg_price_per_room)</span>
<span id="cb10-3"><a href=""></a>hotel_rs</span>
<span id="cb10-4"><a href=""></a><span class="co">#&gt; #  10-fold cross-validation using stratification </span></span>
<span id="cb10-5"><a href=""></a><span class="co">#&gt; # A tibble: 10 × 2</span></span>
<span id="cb10-6"><a href=""></a><span class="co">#&gt;    splits             id    </span></span>
<span id="cb10-7"><a href=""></a><span class="co">#&gt;    &lt;list&gt;             &lt;chr&gt; </span></span>
<span id="cb10-8"><a href=""></a><span class="co">#&gt;  1 &lt;split [3372/377]&gt; Fold01</span></span>
<span id="cb10-9"><a href=""></a><span class="co">#&gt;  2 &lt;split [3373/376]&gt; Fold02</span></span>
<span id="cb10-10"><a href=""></a><span class="co">#&gt;  3 &lt;split [3373/376]&gt; Fold03</span></span>
<span id="cb10-11"><a href=""></a><span class="co">#&gt;  4 &lt;split [3373/376]&gt; Fold04</span></span>
<span id="cb10-12"><a href=""></a><span class="co">#&gt;  5 &lt;split [3373/376]&gt; Fold05</span></span>
<span id="cb10-13"><a href=""></a><span class="co">#&gt;  6 &lt;split [3374/375]&gt; Fold06</span></span>
<span id="cb10-14"><a href=""></a><span class="co">#&gt;  7 &lt;split [3375/374]&gt; Fold07</span></span>
<span id="cb10-15"><a href=""></a><span class="co">#&gt;  8 &lt;split [3376/373]&gt; Fold08</span></span>
<span id="cb10-16"><a href=""></a><span class="co">#&gt;  9 &lt;split [3376/373]&gt; Fold09</span></span>
<span id="cb10-17"><a href=""></a><span class="co">#&gt; 10 &lt;split [3376/373]&gt; Fold10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">

</div>
</section>
<section id="prepare-your-data-for-modeling" class="slide level2">
<h2>Prepare your data for modeling <img data-src="hexes/recipes.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<ul>
<li>The recipes package is an extensible framework for pipeable sequences of preprocessing and feature engineering steps.</li>
</ul>
<div class="fragment">
<ul>
<li>Statistical parameters for the steps can be <em>estimated</em> from an initial data set and then <em>applied</em> to other data sets.</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>The resulting processed output can be used as inputs for statistical or machine learning models.</li>
</ul>
<div class="footer">

</div>
</div>
</section>
<section id="a-first-recipe" class="slide level2">
<h2>A first recipe <img data-src="hexes/recipes.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href=""></a>hotel_rec <span class="ot">&lt;-</span> </span>
<span id="cb11-2"><a href=""></a>  <span class="fu">recipe</span>(avg_price_per_room <span class="sc">~</span> ., <span class="at">data =</span> hotel_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<ul>
<li>The <code>recipe()</code> function assigns columns to roles of “outcome” or “predictor” using the formula</li>
</ul>
<div class="footer">

</div>
</div>
</section>
<section id="a-first-recipe-1" class="slide level2">
<h2>A first recipe <img data-src="hexes/recipes.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href=""></a><span class="fu">summary</span>(hotel_rec)</span>
<span id="cb12-2"><a href=""></a><span class="co">#&gt; # A tibble: 27 × 4</span></span>
<span id="cb12-3"><a href=""></a><span class="co">#&gt;    variable                type      role      source  </span></span>
<span id="cb12-4"><a href=""></a><span class="co">#&gt;    &lt;chr&gt;                   &lt;list&gt;    &lt;chr&gt;     &lt;chr&gt;   </span></span>
<span id="cb12-5"><a href=""></a><span class="co">#&gt;  1 lead_time               &lt;chr [2]&gt; predictor original</span></span>
<span id="cb12-6"><a href=""></a><span class="co">#&gt;  2 stays_in_weekend_nights &lt;chr [2]&gt; predictor original</span></span>
<span id="cb12-7"><a href=""></a><span class="co">#&gt;  3 stays_in_week_nights    &lt;chr [2]&gt; predictor original</span></span>
<span id="cb12-8"><a href=""></a><span class="co">#&gt;  4 adults                  &lt;chr [2]&gt; predictor original</span></span>
<span id="cb12-9"><a href=""></a><span class="co">#&gt;  5 children                &lt;chr [2]&gt; predictor original</span></span>
<span id="cb12-10"><a href=""></a><span class="co">#&gt;  6 babies                  &lt;chr [2]&gt; predictor original</span></span>
<span id="cb12-11"><a href=""></a><span class="co">#&gt;  7 meal                    &lt;chr [3]&gt; predictor original</span></span>
<span id="cb12-12"><a href=""></a><span class="co">#&gt;  8 country                 &lt;chr [3]&gt; predictor original</span></span>
<span id="cb12-13"><a href=""></a><span class="co">#&gt;  9 market_segment          &lt;chr [3]&gt; predictor original</span></span>
<span id="cb12-14"><a href=""></a><span class="co">#&gt; 10 distribution_channel    &lt;chr [3]&gt; predictor original</span></span>
<span id="cb12-15"><a href=""></a><span class="co">#&gt; # ℹ 17 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>type</code> column contains information on the variables</p>
<aside class="notes">
<p>In the context of a recipe from the recipes package in tidymodels, each column has a type vector that describes what kind of data it is (e.g., numeric, nominal, date). These are used internally to apply preprocessing steps selectively.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="footer">

</div>
</section>
<section id="your-turn-1" class="slide level2" data-transition="slide-in">
<h2>Your turn</h2>
<p>What do you think are in the <code>type</code> vectors for the <code>lead_time</code> and <code>country</code> columns?</p>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="var-types" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">−</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">03</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
<aside class="notes">
<p>lead_time is a numeric variable that measures the number of days between the booking and the arrival. country is a categorical (factor) variable representing the guest’s country of origin.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="footer">

</div>
</section>
<section id="create-indicator-variables" class="slide level2">
<h2>Create indicator variables <img data-src="hexes/recipes.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" data-code-line-numbers="3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href=""></a>hotel_rec <span class="ot">&lt;-</span> </span>
<span id="cb13-2"><a href=""></a>  <span class="fu">recipe</span>(avg_price_per_room <span class="sc">~</span> ., <span class="at">data =</span> hotel_train) <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href=""></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<aside class="notes">
<p>What it does: Converts all categorical (nominal) predictors into dummy variables (also known as one-hot encoding).</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="fragment">
<ul>
<li><p>For any factor or character predictors, make binary indicators.</p></li>
<li><p>There are <em>many</em> recipe steps that can convert categorical predictors to numeric columns.</p></li>
<li><p><code>step_dummy()</code> records the levels of the categorical predictors in the training set.</p></li>
</ul>
<div class="footer">

</div>
</div>
</section>
<section id="filter-out-constant-columns" class="slide level2">
<h2>Filter out constant columns <img data-src="hexes/recipes.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" data-code-line-numbers="4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href=""></a>hotel_rec <span class="ot">&lt;-</span> </span>
<span id="cb14-2"><a href=""></a>  <span class="fu">recipe</span>(avg_price_per_room <span class="sc">~</span> ., <span class="at">data =</span> hotel_train) <span class="sc">%&gt;%</span> </span>
<span id="cb14-3"><a href=""></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb14-4"><a href=""></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<aside class="notes">
<p>Removes any predictors that have zero variance (i.e., the same value in every row).</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<p>In case there is a factor level that was never observed in the training data (resulting in a column of all <code>0</code>s), we can delete any <em>zero-variance</em> predictors that have a single unique value.</p>
<aside class="notes">
<p>Note that the selector chooses all columns with a role of “predictor”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="footer">

</div>
</div>
</section>
<section id="normalization" class="slide level2">
<h2>Normalization <img data-src="hexes/recipes.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" data-code-line-numbers="5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href=""></a>hotel_rec <span class="ot">&lt;-</span> </span>
<span id="cb15-2"><a href=""></a>  <span class="fu">recipe</span>(avg_price_per_room <span class="sc">~</span> ., <span class="at">data =</span> hotel_train) <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href=""></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb15-4"><a href=""></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb15-5"><a href=""></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<aside class="notes">
<p>Centers and scales numeric predictors to have mean 0 and standard deviation 1.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="fragment">
<ul>
<li><p>This <a href="https://aml4td.org/chapters/numeric-predictors.html#sec-common-scale">centers and scales</a> the numeric predictors.</p></li>
<li><p>The recipe will use the <em>training</em> set to estimate the means and standard deviations of the data.</p></li>
</ul>
</div>
<div class="fragment">
<ul>
<li>All data the recipe is applied to will be normalized using those statistics (there is no re-estimation).</li>
</ul>
<div class="footer">

</div>
</div>
</section>
<section id="reduce-correlation" class="slide level2">
<h2>Reduce correlation <img data-src="hexes/recipes.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" data-code-line-numbers="6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href=""></a>hotel_rec <span class="ot">&lt;-</span> </span>
<span id="cb16-2"><a href=""></a>  <span class="fu">recipe</span>(avg_price_per_room <span class="sc">~</span> ., <span class="at">data =</span> hotel_train) <span class="sc">%&gt;%</span> </span>
<span id="cb16-3"><a href=""></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb16-4"><a href=""></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb16-5"><a href=""></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb16-6"><a href=""></a>  <span class="fu">step_corr</span>(<span class="fu">all_numeric_predictors</span>(), <span class="at">threshold =</span> <span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>To deal with highly correlated predictors, find the minimum set of predictor columns that make the pairwise correlations less than the threshold.</p>
<div class="footer">

</div>
</div>
</section>
<section id="other-possible-steps" class="slide level2">
<h2>Other possible steps <img data-src="hexes/recipes.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" data-code-line-numbers="6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href=""></a>hotel_rec <span class="ot">&lt;-</span> </span>
<span id="cb17-2"><a href=""></a>  <span class="fu">recipe</span>(avg_price_per_room <span class="sc">~</span> ., <span class="at">data =</span> hotel_train) <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href=""></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb17-4"><a href=""></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb17-5"><a href=""></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb17-6"><a href=""></a>  <span class="fu">step_pca</span>(<span class="fu">all_numeric_predictors</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p><a href="https://aml4td.org/chapters/embeddings.html#principal-component-analysis">PCA</a> feature extraction…</p>
<div class="footer">

</div>
</div>
</section>
<section id="other-possible-steps-1" class="slide level2">
<h2>Other possible steps <img data-src="hexes/recipes.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/embed.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" data-code-line-numbers="6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href=""></a>hotel_rec <span class="ot">&lt;-</span> </span>
<span id="cb18-2"><a href=""></a>  <span class="fu">recipe</span>(avg_price_per_room <span class="sc">~</span> ., <span class="at">data =</span> hotel_train) <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href=""></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb18-4"><a href=""></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb18-5"><a href=""></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb18-6"><a href=""></a>  embed<span class="sc">::</span><span class="fu">step_umap</span>(<span class="fu">all_numeric_predictors</span>(), <span class="at">outcome =</span> <span class="fu">vars</span>(avg_price_per_room))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>A fancy machine learning supervised dimension reduction technique called <a href="https://aml4td.org/chapters/embeddings.html#sec-umap">UMAP</a>…</p>
<aside class="notes">
<p>Note that this uses the outcome, and it is from an extension package</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="footer">

</div>
</div>
</section>
<section id="other-possible-steps-2" class="slide level2">
<h2>Other possible steps <img data-src="hexes/recipes.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" data-code-line-numbers="6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href=""></a>hotel_rec <span class="ot">&lt;-</span> </span>
<span id="cb19-2"><a href=""></a>  <span class="fu">recipe</span>(avg_price_per_room <span class="sc">~</span> ., <span class="at">data =</span> hotel_train) <span class="sc">%&gt;%</span> </span>
<span id="cb19-3"><a href=""></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb19-4"><a href=""></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb19-5"><a href=""></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb19-6"><a href=""></a>  <span class="fu">step_spline_natural</span>(arrival_date_num, <span class="at">deg_free =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>Nonlinear transforms like <a href="https://aml4td.org/chapters/interactions-nonlinear.html#sec-splines">natural splines</a>, and so on!</p>
<div class="footer">

</div>
</div>
</section>
<section id="section-1" class="slide level2" data-background-iframe="https://recipes.tidymodels.org/reference/index.html">
<h2></h2>
<div class="footer">

</div>
</section>
<section id="your-turn-2" class="slide level2" data-transition="slide-in">
<h2>Your turn</h2>
<p><img data-src="images/parsnip-flagger.jpg" class="absolute" style="top: 0px; right: 0px; width: 150px; height: 150px; "></p>
<p><em>Create a <code>recipe()</code> for the hotel data to:</em></p>
<ul>
<li><em>use a Yeo-Johnson (YJ) transformation on <code>lead_time</code></em></li>
<li><em>convert factors to indicator variables</em></li>
<li><em>remove zero-variance variables</em></li>
<li><em>add the spline technique shown above</em></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="make-recipe" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">−</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
<div class="footer">

</div>
</section>
<section id="minimal-recipe" class="slide level2">
<h2>Minimal recipe <img data-src="hexes/recipes.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href=""></a>hotel_indicators <span class="ot">&lt;-</span></span>
<span id="cb20-2"><a href=""></a>  <span class="fu">recipe</span>(avg_price_per_room <span class="sc">~</span> ., <span class="at">data =</span> hotel_train) <span class="sc">%&gt;%</span> </span>
<span id="cb20-3"><a href=""></a>  <span class="fu">step_YeoJohnson</span>(lead_time) <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href=""></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb20-5"><a href=""></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb20-6"><a href=""></a>  <span class="fu">step_spline_natural</span>(arrival_date_num, <span class="at">deg_free =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<aside class="notes">
<p>The Yeo-Johnson (YJ) transformation is a power transformation used to make data more normal (Gaussian)-like, which can improve performance of models that assume normally distributed input or residuals (like linear regression).</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="footer">

</div>
</section>
<section id="measuring-performance" class="slide level2">
<h2>Measuring Performance <img data-src="hexes/yardstick.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<p>We’ll compute two measures: mean absolute error and the coefficient of determination (a.k.a <span class="math inline">\(R^2\)</span>).</p>
<p><span class="math display">\[\begin{align}
MAE &amp;= \frac{1}{n}\sum_{i=1}^n |y_i - \hat{y}_i| \notag \\
R^2 &amp;= cor(y_i, \hat{y}_i)^2
\end{align}\]</span></p>
<p>The focus will be on MAE for parameter optimization. We’ll use a metric set to compute these:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href=""></a>reg_metrics <span class="ot">&lt;-</span> <span class="fu">metric_set</span>(mae, rsq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">

</div>
</section>
<section id="using-a-workflow" class="slide level2">
<h2>Using a workflow <img data-src="hexes/workflows.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/tune.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "> <img data-src="hexes/recipes.png" class="absolute" style="top: -20px; right: 128px; width: 64px; height: 74.24px; "> <img data-src="hexes/parsnip.png" class="absolute" style="top: -20px; right: 192px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">9</span>)</span>
<span id="cb22-2"><a href=""></a></span>
<span id="cb22-3"><a href=""></a>hotel_lm_wflow <span class="ot">&lt;-</span></span>
<span id="cb22-4"><a href=""></a>  <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb22-5"><a href=""></a>  <span class="fu">add_recipe</span>(hotel_indicators) <span class="sc">%&gt;%</span></span>
<span id="cb22-6"><a href=""></a>  <span class="fu">add_model</span>(<span class="fu">linear_reg</span>())</span>
<span id="cb22-7"><a href=""></a> </span>
<span id="cb22-8"><a href=""></a>ctrl <span class="ot">&lt;-</span> <span class="fu">control_resamples</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-9"><a href=""></a>hotel_lm_res <span class="ot">&lt;-</span></span>
<span id="cb22-10"><a href=""></a>  hotel_lm_wflow <span class="sc">%&gt;%</span></span>
<span id="cb22-11"><a href=""></a>  <span class="fu">fit_resamples</span>(hotel_rs, <span class="at">control =</span> ctrl, <span class="at">metrics =</span> reg_metrics)</span>
<span id="cb22-12"><a href=""></a></span>
<span id="cb22-13"><a href=""></a><span class="fu">collect_metrics</span>(hotel_lm_res)</span>
<span id="cb22-14"><a href=""></a><span class="co">#&gt; # A tibble: 2 × 6</span></span>
<span id="cb22-15"><a href=""></a><span class="co">#&gt;   .metric .estimator   mean     n std_err .config             </span></span>
<span id="cb22-16"><a href=""></a><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span id="cb22-17"><a href=""></a><span class="co">#&gt; 1 mae     standard   16.6      10 0.214   Preprocessor1_Model1</span></span>
<span id="cb22-18"><a href=""></a><span class="co">#&gt; 2 rsq     standard    0.884    10 0.00339 Preprocessor1_Model1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">

</div>
</section>
<section id="your-turn-3" class="slide level2" data-transition="slide-in">
<h2>Your turn</h2>
<p><img data-src="images/parsnip-flagger.jpg" class="absolute" style="top: 0px; right: 0px; width: 150px; height: 150px; "></p>
<p><em>Use <code>fit_resamples()</code> to fit your workflow with a recipe.</em></p>
<p><em>Collect the predictions from the results.</em></p>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="resample-recipe" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">−</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
<div class="footer">

</div>
</section>
<section id="holdout-predictions" class="slide level2">
<h2>Holdout predictions <img data-src="hexes/workflows.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/tune.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "> <img data-src="hexes/recipes.png" class="absolute" style="top: -20px; right: 128px; width: 64px; height: 74.24px; "> <img data-src="hexes/parsnip.png" class="absolute" style="top: -20px; right: 192px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href=""></a><span class="co"># Since we used `save_pred = TRUE`</span></span>
<span id="cb23-2"><a href=""></a>lm_cv_pred <span class="ot">&lt;-</span> <span class="fu">collect_predictions</span>(hotel_lm_res)</span>
<span id="cb23-3"><a href=""></a>lm_cv_pred <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">7</span>)</span>
<span id="cb23-4"><a href=""></a><span class="co">#&gt; # A tibble: 3,749 × 5</span></span>
<span id="cb23-5"><a href=""></a><span class="co">#&gt;   .pred id      .row avg_price_per_room .config             </span></span>
<span id="cb23-6"><a href=""></a><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt;  &lt;int&gt;              &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span id="cb23-7"><a href=""></a><span class="co">#&gt; 1  75.1 Fold01    20                 40 Preprocessor1_Model1</span></span>
<span id="cb23-8"><a href=""></a><span class="co">#&gt; 2  49.3 Fold01    28                 54 Preprocessor1_Model1</span></span>
<span id="cb23-9"><a href=""></a><span class="co">#&gt; 3  64.9 Fold01    45                 50 Preprocessor1_Model1</span></span>
<span id="cb23-10"><a href=""></a><span class="co">#&gt; 4  52.8 Fold01    49                 42 Preprocessor1_Model1</span></span>
<span id="cb23-11"><a href=""></a><span class="co">#&gt; 5  48.6 Fold01    61                 49 Preprocessor1_Model1</span></span>
<span id="cb23-12"><a href=""></a><span class="co">#&gt; 6  29.8 Fold01    66                 40 Preprocessor1_Model1</span></span>
<span id="cb23-13"><a href=""></a><span class="co">#&gt; 7  36.9 Fold01    88                 49 Preprocessor1_Model1</span></span>
<span id="cb23-14"><a href=""></a><span class="co">#&gt; # ℹ 3,742 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">

</div>
</section>
<section id="calibration-plot" class="slide level2">
<h2>Calibration Plot <img data-src="hexes/probably.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href=""></a><span class="fu">library</span>(probably)</span>
<span id="cb24-2"><a href=""></a></span>
<span id="cb24-3"><a href=""></a><span class="fu">cal_plot_regression</span>(hotel_lm_res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="part-II_files/figure-revealjs/lm-cal-plot-1.svg" class="quarto-figure quarto-figure-center" style="width:40.0%"></p>
</figure>
</div>
</div>
</div>
<aside class="notes">
<p>a calibration plot checks how well the model’s predicted values align with the true values across their range.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="footer">

</div>
</section>
<section id="what-do-we-do-with-the-agent-and-company-data" class="slide level2">
<h2>What do we do with the agent and company data?</h2>
<p>There are 98 unique agent values and 100 unique companies in our training set. How can we include this information in our model?</p>
<div class="fragment">
<p>We could:</p>
<ul>
<li><p>make the full set of indicator variables 😳</p></li>
<li><p>lump agents and companies that rarely occur into an “other” group</p></li>
<li><p>use <a href="https://www.tmwr.org/categorical.html#feature-hashing">feature hashing</a> to create a smaller set of indicator variables</p></li>
<li><p>use <a href="https://aml4td.org/chapters/categorical-predictors.html#sec-effect-encodings">effect encoding</a> to replace the <code>agent</code> and <code>company</code> columns with the estimated effect of that predictor (in the extra materials)</p></li>
</ul>
<aside class="notes">
<p>Feature hashing (also known as the hashing trick) is a technique used to efficiently encode high-cardinality categorical variables into a fixed-length numerical vector — without explicitly storing the dictionary of categories.</p>
<p>In dummy (one-hot) encoding, one level is used as the reference, and other levels are compared to it. In effect encoding, each category’s effect is compared to the grand mean (the average across all categories)</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="footer">

</div>
</div>
</section>
<section id="per-agent-statistics" class="slide level2">
<h2>Per-agent statistics</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="part-II_files/figure-revealjs/effects-freq-1.svg" class="quarto-figure quarto-figure-center" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="part-II_files/figure-revealjs/effects-adr-1.svg" class="quarto-figure quarto-figure-center" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
<div class="footer">

</div>
</section>
<section id="collapsing-factor-levels" class="slide level2">
<h2>Collapsing factor levels <img data-src="hexes/recipes.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<p>There is a recipe step that will redefine factor levels based on their frequency in the training set:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25" data-code-line-numbers="4|"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href=""></a>hotel_other_rec <span class="ot">&lt;-</span></span>
<span id="cb25-2"><a href=""></a>  <span class="fu">recipe</span>(avg_price_per_room <span class="sc">~</span> ., <span class="at">data =</span> hotel_train) <span class="sc">%&gt;%</span> </span>
<span id="cb25-3"><a href=""></a>  <span class="fu">step_YeoJohnson</span>(lead_time) <span class="sc">%&gt;%</span></span>
<span id="cb25-4"><a href=""></a>  <span class="fu">step_other</span>(agent, <span class="at">threshold =</span> <span class="fl">0.001</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-5"><a href=""></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb25-6"><a href=""></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb25-7"><a href=""></a>  <span class="fu">step_spline_natural</span>(arrival_date_num, <span class="at">deg_free =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using this code, 34 agents (out of 98) were collapsed into “other” based on the training set.</p>
<p>We <em>could</em> try to optimize the threshold for collapsing (we will get to model tuning later).</p>
<div class="footer">

</div>
</section>
<section id="does-othering-help" class="slide level2">
<h2>Does othering help? <img data-src="hexes/tune.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/recipes.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" data-code-line-numbers="3|"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href=""></a>hotel_other_wflow <span class="ot">&lt;-</span></span>
<span id="cb26-2"><a href=""></a>  hotel_lm_wflow <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href=""></a>  <span class="fu">update_recipe</span>(hotel_other_rec)</span>
<span id="cb26-4"><a href=""></a></span>
<span id="cb26-5"><a href=""></a>hotel_other_res <span class="ot">&lt;-</span></span>
<span id="cb26-6"><a href=""></a>  hotel_other_wflow <span class="sc">%&gt;%</span></span>
<span id="cb26-7"><a href=""></a>  <span class="fu">fit_resamples</span>(hotel_rs, <span class="at">control =</span> ctrl, <span class="at">metrics =</span> reg_metrics)</span>
<span id="cb26-8"><a href=""></a></span>
<span id="cb26-9"><a href=""></a><span class="fu">collect_metrics</span>(hotel_other_res)</span>
<span id="cb26-10"><a href=""></a><span class="co">#&gt; # A tibble: 2 × 6</span></span>
<span id="cb26-11"><a href=""></a><span class="co">#&gt;   .metric .estimator   mean     n std_err .config             </span></span>
<span id="cb26-12"><a href=""></a><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span id="cb26-13"><a href=""></a><span class="co">#&gt; 1 mae     standard   16.7      10 0.213   Preprocessor1_Model1</span></span>
<span id="cb26-14"><a href=""></a><span class="co">#&gt; 2 rsq     standard    0.884    10 0.00341 Preprocessor1_Model1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>About the same MAE and much faster to complete.</p>
<p>Now let’s look at a more sophisticated tool called effect feature hashing.</p>
<div class="footer">

</div>
</section>
<section id="feature-hashing" class="slide level2">
<h2>Feature Hashing</h2>
<p>Between <code>agent</code> and <code>company</code>, simple dummy variables would create 198 new columns (that are mostly zeros).</p>
<p>Another option is to have a binary indicator that combines some levels of these variables.</p>
<p>Feature hashing (for more see <a href="https://bookdown.org/max/FES/encoding-predictors-with-many-categories.html"><em>FES</em></a>, <a href="https://smltar.com/mlregression.html#case-study-feature-hashing"><em>SMLTAR</em></a>, <a href="https://www.tmwr.org/categorical.html#feature-hashing"><em>TMwR</em></a>, and <a href="https://aml4td.org/chapters/categorical-predictors.html#sec-feature-hashing"><em>aml4td</em></a>):</p>
<ul>
<li>uses the character values of the levels</li>
<li>converts them to integer hash values</li>
<li>uses the integers to assign them to a specific indicator column.</li>
</ul>
<div class="footer">

</div>
</section>
<section id="feature-hashing-1" class="slide level2">
<h2>Feature Hashing</h2>
<p>Suppose we want to use 32 indicator variables for <code>agent</code>.</p>
<p>For a agent with value “<code>Max_Kuhn</code>”, a hashing function converts it to an integer (say 210397726).</p>
<p>To assign it to one of the 32 columns, we would use modular arithmetic to assign it to a column:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href=""></a><span class="co"># For "Max_Kuhn" put a '1' in column: </span></span>
<span id="cb27-2"><a href=""></a><span class="dv">210397726</span> <span class="sc">%%</span> <span class="dv">32</span></span>
<span id="cb27-3"><a href=""></a><span class="co">#&gt; [1] 30</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="https://www.metamorphosite.com/one-way-hash-encryption-sha1-data-software">Hash functions</a> are meant to <em>emulate</em> randomness.</p>
<aside class="notes">
<p>fast and memory-efficient solution we apply a hash function to the category, map it to an integer in a fixed range, say, 0 to n-1 where n is the number of output features you want.</p>
<p>Suppose you want only 32 output features. You take the hash value and apply modulo 32 -&gt; 30 This means: place a 1 in column 30 of a length-32 vector. The rest are zeros.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="footer">

</div>
</section>
<section id="feature-hashing-pros" class="slide level2">
<h2>Feature Hashing Pros</h2>
<ul>
<li>The procedure will automatically work on new values of the predictors.</li>
<li>It is fast.</li>
<li>“Signed” hashes add a sign to help avoid aliasing.</li>
</ul>
<aside class="notes">
<p>Optionally, use the hash to assign a sign (+1 or -1) to reduce collision impact. Hash collisions: Different inputs can map to the same output → information loss.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="footer">

</div>
</section>
<section id="feature-hashing-cons" class="slide level2">
<h2>Feature Hashing Cons</h2>
<ul>
<li>There is no real logic behind which factor levels are combined.</li>
<li>We don’t know how many columns to add (more in the next section).</li>
<li>Some columns may have all zeros.</li>
<li>If a indicator column is important to the model, we can’t easily determine why.</li>
</ul>
<aside class="notes">
<p>The signed hash make it slightly more possible to differentiate between confounded levels</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="footer">

</div>
</section>
<section id="feature-hashing-in-recipes" class="slide level2">
<h2>Feature Hashing in recipes <img data-src="hexes/workflows.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/textrecipes.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "> <img data-src="hexes/recipes.png" class="absolute" style="top: -20px; right: 128px; width: 64px; height: 74.24px; "></h2>
<p>The textrecipes package has a step that can be added to the recipe:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28" data-code-line-numbers="6-8|"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href=""></a><span class="fu">library</span>(textrecipes)</span>
<span id="cb28-2"><a href=""></a></span>
<span id="cb28-3"><a href=""></a>hash_rec <span class="ot">&lt;-</span></span>
<span id="cb28-4"><a href=""></a>  <span class="fu">recipe</span>(avg_price_per_room <span class="sc">~</span> ., <span class="at">data =</span> hotel_train) <span class="sc">%&gt;%</span></span>
<span id="cb28-5"><a href=""></a>  <span class="fu">step_YeoJohnson</span>(lead_time) <span class="sc">%&gt;%</span></span>
<span id="cb28-6"><a href=""></a>  <span class="co"># Defaults to 32 signed indicator columns</span></span>
<span id="cb28-7"><a href=""></a>  <span class="fu">step_dummy_hash</span>(agent) <span class="sc">%&gt;%</span></span>
<span id="cb28-8"><a href=""></a>  <span class="fu">step_dummy_hash</span>(company) <span class="sc">%&gt;%</span></span>
<span id="cb28-9"><a href=""></a>  <span class="co"># Regular indicators for the others</span></span>
<span id="cb28-10"><a href=""></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb28-11"><a href=""></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb28-12"><a href=""></a>  <span class="fu">step_spline_natural</span>(arrival_date_num, <span class="at">deg_free =</span> <span class="dv">10</span>)</span>
<span id="cb28-13"><a href=""></a></span>
<span id="cb28-14"><a href=""></a>hotel_hash_wflow <span class="ot">&lt;-</span></span>
<span id="cb28-15"><a href=""></a>  hotel_lm_wflow <span class="sc">%&gt;%</span></span>
<span id="cb28-16"><a href=""></a>  <span class="fu">update_recipe</span>(hash_rec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">

</div>
</section>
<section id="feature-hashing-in-recipes-1" class="slide level2">
<h2>Feature Hashing in recipes <img data-src="hexes/tune.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/textrecipes.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "> <img data-src="hexes/recipes.png" class="absolute" style="top: -20px; right: 128px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href=""></a>hotel_hash_res <span class="ot">&lt;-</span></span>
<span id="cb29-2"><a href=""></a>  hotel_hash_wflow <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href=""></a>  <span class="fu">fit_resamples</span>(hotel_rs, <span class="at">control =</span> ctrl, <span class="at">metrics =</span> reg_metrics)</span>
<span id="cb29-4"><a href=""></a></span>
<span id="cb29-5"><a href=""></a><span class="fu">collect_metrics</span>(hotel_hash_res)</span>
<span id="cb29-6"><a href=""></a><span class="co">#&gt; # A tibble: 2 × 6</span></span>
<span id="cb29-7"><a href=""></a><span class="co">#&gt;   .metric .estimator   mean     n std_err .config             </span></span>
<span id="cb29-8"><a href=""></a><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span id="cb29-9"><a href=""></a><span class="co">#&gt; 1 mae     standard   16.7      10 0.239   Preprocessor1_Model1</span></span>
<span id="cb29-10"><a href=""></a><span class="co">#&gt; 2 rsq     standard    0.884    10 0.00324 Preprocessor1_Model1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>About the same performance but now we can handle new values.</p>
<aside class="notes">
<p>When you use step_dummy():</p>
<pre><code>•   It creates one column per category 
(e.g., agent_241, agent_204).
•   If a new level appears in test/predict data 
(e.g., agent_999), it wasn’t seen during training
so prediction fails or ignores that value.</code></pre>
<p>Now every category (even new ones) is passed through a hash function, which maps it to one of the fixed output columns (like 32 buckets). This means:</p>
<pre><code>•   No need to store or match all 
unique category names
•   New/unseen levels 
won’t break the model
•   The model remains robust 
and deployable in production</code></pre>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="footer">

</div>
</section>
<section id="debugging-a-recipe" class="slide level2">
<h2>Debugging a recipe</h2>
<ul>
<li>Typically, you will want to use a workflow to estimate and apply a recipe.</li>
</ul>
<div class="fragment">
<ul>
<li>If you have an error and need to debug your recipe, the original recipe object (e.g.&nbsp;<code>hash_rec</code>) can be estimated manually with a function called <code>prep()</code>. It is analogous to <code>fit()</code>. See <a href="https://www.tmwr.org/dimensionality.html#recipe-functions">TMwR section 16.4</a></li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Another function (<code>bake()</code>) is analogous to <code>predict()</code>, and gives you the processed data back.</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>The <code>tidy()</code> function can be used to get specific results from the recipe.</li>
</ul>
<div class="footer">

</div>
</div>
</section>
<section id="example" class="slide level2">
<h2>Example <img data-src="hexes/recipes.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/broom.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href=""></a>hash_rec_fit <span class="ot">&lt;-</span> <span class="fu">prep</span>(hash_rec)</span>
<span id="cb32-2"><a href=""></a></span>
<span id="cb32-3"><a href=""></a><span class="co"># Get the transformation coefficient</span></span>
<span id="cb32-4"><a href=""></a><span class="fu">tidy</span>(hash_rec_fit, <span class="at">number =</span> <span class="dv">1</span>)</span>
<span id="cb32-5"><a href=""></a></span>
<span id="cb32-6"><a href=""></a><span class="co"># Get the processed data</span></span>
<span id="cb32-7"><a href=""></a><span class="fu">bake</span>(hash_rec_fit, hotel_train <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), <span class="fu">contains</span>(<span class="st">"_agent_"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<aside class="notes">
<p>prep summary:</p>
<pre><code>•   Applies transformations to numeric variables
•   Handles high-cardinality categorical variables (agent, company) using feature hashing
•   One-hot encodes smaller factors
•   Drops useless predictors
•   Adds nonlinear flexibility via splines</code></pre>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="footer">

</div>
</section>
<section id="more-on-recipes" class="slide level2">
<h2>More on recipes</h2>
<ul>
<li>Once <code>fit()</code> is called on a workflow, changing the model does not re-fit the recipe.</li>
</ul>
<div class="fragment">
<ul>
<li>A list of all known steps is at <a href="https://www.tidymodels.org/find/recipes/" class="uri">https://www.tidymodels.org/find/recipes/</a>.</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Some steps can be <a href="https://recipes.tidymodels.org/articles/Skipping.html">skipped</a> when using <code>predict()</code>.</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>The <a href="https://recipes.tidymodels.org/articles/Ordering.html">order</a> of the steps matters.</li>
</ul>
<div class="footer">

</div>
</div>
</section></section>
<section>
<section id="open-worksheet-2" class="title-slide slide level1 center">
<h1>Open Worksheet 2 📄</h1>
<div class="footer">

</div>
<div class="footer">

</div>
</section>
<section id="previously---setup-1" class="slide level2">
<h2>Previously - Setup <img data-src="hexes/tidymodels.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href=""></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb34-2"><a href=""></a><span class="fu">library</span>(textrecipes)</span>
<span id="cb34-3"><a href=""></a><span class="fu">library</span>(bonsai)</span>
<span id="cb34-4"><a href=""></a></span>
<span id="cb34-5"><a href=""></a><span class="co"># extra settings: </span></span>
<span id="cb34-6"><a href=""></a><span class="fu">tidymodels_prefer</span>()</span>
<span id="cb34-7"><a href=""></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())</span>
<span id="cb34-8"><a href=""></a><span class="fu">options</span>(</span>
<span id="cb34-9"><a href=""></a>  <span class="at">pillar.advice =</span> <span class="cn">FALSE</span>, </span>
<span id="cb34-10"><a href=""></a>  <span class="at">pillar.min_title_chars =</span> <span class="cn">Inf</span></span>
<span id="cb34-11"><a href=""></a>)</span>
<span id="cb34-12"><a href=""></a></span>
<span id="cb34-13"><a href=""></a>reg_metrics <span class="ot">&lt;-</span> <span class="fu">metric_set</span>(mae, rsq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href=""></a><span class="fu">data</span>(hotel_rates)</span>
<span id="cb35-2"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">295</span>)</span>
<span id="cb35-3"><a href=""></a>hotel_rates <span class="ot">&lt;-</span> </span>
<span id="cb35-4"><a href=""></a>  hotel_rates <span class="sc">%&gt;%</span> </span>
<span id="cb35-5"><a href=""></a>  <span class="fu">sample_n</span>(<span class="dv">5000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-6"><a href=""></a>  <span class="fu">arrange</span>(arrival_date) <span class="sc">%&gt;%</span> </span>
<span id="cb35-7"><a href=""></a>  <span class="fu">select</span>(<span class="sc">-</span>arrival_date) <span class="sc">%&gt;%</span> </span>
<span id="cb35-8"><a href=""></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-9"><a href=""></a>    <span class="at">company =</span> <span class="fu">factor</span>(<span class="fu">as.character</span>(company)),</span>
<span id="cb35-10"><a href=""></a>    <span class="at">country =</span> <span class="fu">factor</span>(<span class="fu">as.character</span>(country)),</span>
<span id="cb35-11"><a href=""></a>    <span class="at">agent =</span> <span class="fu">factor</span>(<span class="fu">as.character</span>(agent))</span>
<span id="cb35-12"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div></div>
<div class="footer">

</div>
</section>
<section id="previously---data-usage-1" class="slide level2">
<h2>Previously - Data Usage <img data-src="hexes/rsample.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">4028</span>)</span>
<span id="cb36-2"><a href=""></a>hotel_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(hotel_rates, <span class="at">strata =</span> avg_price_per_room)</span>
<span id="cb36-3"><a href=""></a></span>
<span id="cb36-4"><a href=""></a>hotel_train <span class="ot">&lt;-</span> <span class="fu">training</span>(hotel_split)</span>
<span id="cb36-5"><a href=""></a>hotel_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(hotel_split)</span>
<span id="cb36-6"><a href=""></a></span>
<span id="cb36-7"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">472</span>)</span>
<span id="cb36-8"><a href=""></a>hotel_rs <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(hotel_train, <span class="at">strata =</span> avg_price_per_room)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">

</div>
</section>
<section id="previously---feature-engineering" class="slide level2">
<h2>Previously - Feature engineering <img data-src="hexes/textrecipes.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/recipes.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href=""></a><span class="fu">library</span>(textrecipes)</span>
<span id="cb37-2"><a href=""></a></span>
<span id="cb37-3"><a href=""></a>hash_rec <span class="ot">&lt;-</span></span>
<span id="cb37-4"><a href=""></a>  <span class="fu">recipe</span>(avg_price_per_room <span class="sc">~</span> ., <span class="at">data =</span> hotel_train) <span class="sc">%&gt;%</span></span>
<span id="cb37-5"><a href=""></a>  <span class="fu">step_YeoJohnson</span>(lead_time) <span class="sc">%&gt;%</span></span>
<span id="cb37-6"><a href=""></a>  <span class="co"># Defaults to 32 signed indicator columns</span></span>
<span id="cb37-7"><a href=""></a>  <span class="fu">step_dummy_hash</span>(agent) <span class="sc">%&gt;%</span></span>
<span id="cb37-8"><a href=""></a>  <span class="fu">step_dummy_hash</span>(company) <span class="sc">%&gt;%</span></span>
<span id="cb37-9"><a href=""></a>  <span class="co"># Regular indicators for the others</span></span>
<span id="cb37-10"><a href=""></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb37-11"><a href=""></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">

</div>
</section></section>
<section>
<section id="optimizing-models-via-tuning-parameters" class="title-slide slide level1 center">
<h1>Optimizing Models via Tuning Parameters</h1>
<div class="footer">

</div>
</section>
<section id="tuning-parameters" class="slide level2">
<h2>Tuning parameters</h2>
<p>Some model or preprocessing parameters cannot be estimated directly from the data.</p>
<div class="fragment">
<p>Some examples:</p>
<ul>
<li>Tree depth in decision trees</li>
<li>Number of neighbors in a K-nearest neighbor model</li>
</ul>
<div class="footer">

</div>
</div>
</section></section>
<section id="activation-function-in-neural-networks" class="title-slide slide level1 center">
<h1>Activation function in neural networks?</h1>
<p>Sigmoidal functions, ReLu, etc.</p>
<div class="fragment">
<p>Yes, it is a tuning parameter. ✅</p>
</div>
<div class="footer">

</div>
</section>

<section id="number-of-feature-hashing-columns-to-generate" class="title-slide slide level1 center">
<h1>Number of feature hashing columns to generate?</h1>
<div class="fragment">
<p>Yes, it is a tuning parameter. ✅</p>
</div>
<div class="footer">

</div>
</section>

<section id="bayesian-priors-for-model-parameters" class="title-slide slide level1 center">
<h1>Bayesian priors for model parameters?</h1>
<div class="fragment">
<p>Hmmmm, probably not. These are based on prior belief. ❌</p>
</div>
<div class="footer">

</div>
<div class="footer">

</div>
</section>

<section>
<section id="the-random-seed" class="title-slide slide level1 center">
<h1>The random seed?</h1>
<div class="fragment">
<p>Nope. It is not. ❌</p>
</div>
<div class="footer">

</div>
</section>
<section id="optimize-tuning-parameters" class="slide level2">
<h2>Optimize tuning parameters</h2>
<ul>
<li>Try different values and measure their performance.</li>
</ul>
<div class="fragment">
<ul>
<li>Find good values for these parameters.</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Once the value(s) of the parameter(s) are determined, a model can be finalized by fitting the model to the entire training set.</li>
</ul>
<div class="footer">

</div>
</div>
</section>
<section id="tagging-parameters-for-tuning" class="slide level2">
<h2>Tagging parameters for tuning <img data-src="hexes/tune.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<p>With tidymodels, you can mark the parameters that you want to optimize with a value of <code>tune()</code>.</p>
<p><br></p>
<p>The function itself just returns… itself:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href=""></a><span class="fu">tune</span>()</span>
<span id="cb38-2"><a href=""></a><span class="co">#&gt; tune()</span></span>
<span id="cb38-3"><a href=""></a><span class="fu">str</span>(<span class="fu">tune</span>())</span>
<span id="cb38-4"><a href=""></a><span class="co">#&gt;  language tune()</span></span>
<span id="cb38-5"><a href=""></a></span>
<span id="cb38-6"><a href=""></a><span class="co"># optionally add a label</span></span>
<span id="cb38-7"><a href=""></a><span class="fu">tune</span>(<span class="st">"I hope that this is going well"</span>)</span>
<span id="cb38-8"><a href=""></a><span class="co">#&gt; tune("I hope that this is going well")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>For example…</p>
<div class="footer">

</div>
</div>
</section>
<section id="optimizing-the-hash-features" class="slide level2">
<h2>Optimizing the hash features <img data-src="hexes/tune.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/textrecipes.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "> <img data-src="hexes/recipes.png" class="absolute" style="top: -20px; right: 128px; width: 64px; height: 74.24px; "></h2>
<p>Our new recipe is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39" data-code-line-numbers="4-5|"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href=""></a>hash_rec <span class="ot">&lt;-</span></span>
<span id="cb39-2"><a href=""></a>  <span class="fu">recipe</span>(avg_price_per_room <span class="sc">~</span> ., <span class="at">data =</span> hotel_train) <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href=""></a>  <span class="fu">step_YeoJohnson</span>(lead_time) <span class="sc">%&gt;%</span></span>
<span id="cb39-4"><a href=""></a>  <span class="fu">step_dummy_hash</span>(agent,   <span class="at">num_terms =</span> <span class="fu">tune</span>(<span class="st">"agent hash"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb39-5"><a href=""></a>  <span class="fu">step_dummy_hash</span>(company, <span class="at">num_terms =</span> <span class="fu">tune</span>(<span class="st">"company hash"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb39-6"><a href=""></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>We will be using a tree-based model in a minute.</p>
<ul>
<li>The other categorical predictors are left as-is.</li>
<li>That’s why there is no <code>step_dummy()</code>.</li>
</ul>
<div class="footer">

</div>
</section>
<section id="boosted-trees" class="slide level2">
<h2>Boosted Trees</h2>
<p>These are popular ensemble methods that build a <em>sequence</em> of tree models.</p>
<p><br></p>
<p>Each tree uses the results of the previous tree to better predict samples, especially those that have been poorly predicted.</p>
<p><br></p>
<p>Each tree in the ensemble is saved and new samples are predicted using a weighted average of the votes of each tree in the ensemble.</p>
<p><br></p>
<p>We’ll focus on the popular lightgbm implementation.</p>
<aside class="notes">
<p>LightGBM (Light Gradient Boosting Machine) is a high-performance implementation of gradient boosting decision trees (GBDT)</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="footer">

</div>
</section>
<section id="boosted-tree-tuning-parameters" class="slide level2">
<h2>Boosted Tree Tuning Parameters</h2>
<p>Some <em>possible</em> parameters:</p>
<ul>
<li><code>mtry</code>: The number of predictors randomly sampled at each split (in <span class="math inline">\([1, ncol(x)]\)</span> or <span class="math inline">\((0, 1]\)</span>).</li>
<li><code>trees</code>: The number of trees (<span class="math inline">\([1, \infty]\)</span>, but usually up to thousands)</li>
<li><code>min_n</code>: The number of samples needed to further split (<span class="math inline">\([1, n]\)</span>).</li>
<li><code>learn_rate</code>: The rate that each tree adapts from previous iterations (<span class="math inline">\((0, \infty]\)</span>, usual maximum is 0.1).</li>
<li><code>stop_iter</code>: The number of iterations of boosting where <em>no improvement</em> was shown before stopping (<span class="math inline">\([1, trees]\)</span>)</li>
</ul>
<div class="footer">

</div>
</section>
<section id="boosted-tree-tuning-parameters-1" class="slide level2">
<h2>Boosted Tree Tuning Parameters</h2>
<p>TBH it is usually not difficult to optimize these models.</p>
<p><br></p>
<p>Often, there are multiple <em>candidate</em> tuning parameter combinations that have very good results.</p>
<p><br></p>
<p>To demonstrate simple concepts, we’ll look at optimizing the number of trees in the ensemble (between 1 and 100) and the learning rate (<span class="math inline">\(10^{-5}\)</span> to <span class="math inline">\(10^{-1}\)</span>).</p>
<div class="footer">

</div>
</section>
<section id="boosted-tree-tuning-parameters-2" class="slide level2">
<h2>Boosted Tree Tuning Parameters <img data-src="hexes/workflows.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/parsnip.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "> <img data-src="hexes/bonsai.png" class="absolute" style="top: -20px; right: 128px; width: 64px; height: 74.24px; "></h2>
<p>We’ll need to load the bonsai package. This has the information needed to use lightgbm</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href=""></a><span class="fu">library</span>(bonsai)</span>
<span id="cb40-2"><a href=""></a>lgbm_spec <span class="ot">&lt;-</span> </span>
<span id="cb40-3"><a href=""></a>  <span class="fu">boost_tree</span>(<span class="at">trees =</span> <span class="fu">tune</span>(), <span class="at">learn_rate =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb40-4"><a href=""></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb40-5"><a href=""></a>  <span class="fu">set_engine</span>(<span class="st">"lightgbm"</span>, <span class="at">num_threads =</span> <span class="dv">1</span>)</span>
<span id="cb40-6"><a href=""></a></span>
<span id="cb40-7"><a href=""></a>lgbm_wflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>(hash_rec, lgbm_spec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">

</div>
</section>
<section id="optimize-tuning-parameters-1" class="slide level2">
<h2>Optimize tuning parameters</h2>
<p>The main two strategies for optimization are:</p>
<div class="fragment">
<ul>
<li><p><strong>Grid search</strong> 💠 which tests a pre-defined set of candidate values</p></li>
<li><p><strong>Iterative search</strong> 🌀 which suggests/estimates new values of candidate parameters to evaluate</p></li>
</ul>
<div class="footer">

</div>
</div>
</section>
<section id="grid-search" class="slide level2">
<h2>Grid search</h2>
<p>A small grid of points trying to minimize the error via learning rate:</p>

<img data-src="images/small_init.svg" class="quarto-figure quarto-figure-center r-stretch" style="width:60.0%"><div class="footer">

</div>
</section>
<section id="grid-search-1" class="slide level2">
<h2>Grid search</h2>
<p>In reality we would probably sample the space more densely:</p>

<img data-src="images/grid_points.svg" class="quarto-figure quarto-figure-center r-stretch" style="width:60.0%"><div class="footer">

</div>
</section>
<section id="iterative-search" class="slide level2">
<h2>Iterative Search</h2>
<p>We could start with a few points and search the space:</p>

<img data-src="animations/anime_seq.gif" class="quarto-figure quarto-figure-center r-stretch" style="width:60.0%"><aside class="notes">
<p>iteratively choosing promising values based on model performance.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="footer">

</div>
</section></section>
<section>
<section id="grid-search-2" class="title-slide slide level1 center">
<h1>Grid Search</h1>
<div class="footer">

</div>
</section>
<section id="parameters" class="slide level2">
<h2>Parameters</h2>
<ul>
<li><p>The tidymodels framework provides pre-defined information on tuning parameters (such as their type, range, transformations, etc).</p></li>
<li><p>The <code>extract_parameter_set_dials()</code> function extracts these tuning parameters and the info.</p></li>
</ul>
<div class="fragment">
<h4 id="grids">Grids</h4>
<ul>
<li><p>Create your grid manually or automatically.</p></li>
<li><p>The <code>grid_*()</code> functions can make a grid.</p></li>
</ul>
</div>
<aside class="notes">
<p>Most basic (but very effective) way to tune models</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="footer">

</div>
</section>
<section id="different-types-of-grids" class="slide level2 annotation">
<h2>Different types of grids <img data-src="hexes/dials.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="part-II_files/figure-revealjs/grid-types-1.svg" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Space-filling designs (SFD) attempt to cover the parameter space without redundant candidates (recommended).</p>
<aside class="notes">
<p>Space-filling designs aim to spread points out evenly across the hyperparameter space, covering it efficiently and uniformly, rather than exhaustively. Also great starting point for iterative search.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="footer">

</div>
</section>
<section id="create-a-grid" class="slide level2">
<h2>Create a grid <img data-src="hexes/workflows.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/dials.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href=""></a>lgbm_wflow <span class="sc">%&gt;%</span> </span>
<span id="cb41-2"><a href=""></a>  <span class="fu">extract_parameter_set_dials</span>()</span>
<span id="cb41-3"><a href=""></a></span>
<span id="cb41-4"><a href=""></a><span class="co"># Individual functions: </span></span>
<span id="cb41-5"><a href=""></a><span class="fu">trees</span>()</span>
<span id="cb41-6"><a href=""></a><span class="fu">learn_rate</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>A parameter set can be updated (e.g.&nbsp;to change the ranges).</p>
</div>
<aside class="notes">
<p>First pull out the set of tunable parameters from a model workflow object (lgbm_wflow) that contains a model with tune() placeholders.</p>
<p>Then we have parameter constructors from the dials package that we define manually:</p>
<ul>
<li>trees(): creates a tunable object for the number of trees in a boosting model.</li>
<li>learn_rate(): creates a tunable object for the learning rate (step size) of boosting. Here we have numeric hyperparameter that controls how quickly the model adapts during training.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="footer">

</div>
</section>
<section id="create-a-grid-1" class="slide level2">
<h2>Create a grid <img data-src="hexes/workflows.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/dials.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">12</span>)</span>
<span id="cb42-2"><a href=""></a>grid <span class="ot">&lt;-</span> </span>
<span id="cb42-3"><a href=""></a>  lgbm_wflow <span class="sc">%&gt;%</span> </span>
<span id="cb42-4"><a href=""></a>  <span class="fu">extract_parameter_set_dials</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb42-5"><a href=""></a>  <span class="fu">grid_space_filling</span>(<span class="at">size =</span> <span class="dv">25</span>)</span>
<span id="cb42-6"><a href=""></a></span>
<span id="cb42-7"><a href=""></a>grid</span>
<span id="cb42-8"><a href=""></a><span class="co">#&gt; # A tibble: 25 × 4</span></span>
<span id="cb42-9"><a href=""></a><span class="co">#&gt;    trees learn_rate `agent hash` `company hash`</span></span>
<span id="cb42-10"><a href=""></a><span class="co">#&gt;    &lt;int&gt;      &lt;dbl&gt;        &lt;int&gt;          &lt;int&gt;</span></span>
<span id="cb42-11"><a href=""></a><span class="co">#&gt;  1     1   7.50e- 6          574            574</span></span>
<span id="cb42-12"><a href=""></a><span class="co">#&gt;  2    84   1.78e- 5         2048           2298</span></span>
<span id="cb42-13"><a href=""></a><span class="co">#&gt;  3   167   5.62e-10         1824            912</span></span>
<span id="cb42-14"><a href=""></a><span class="co">#&gt;  4   250   4.22e- 5         3250            512</span></span>
<span id="cb42-15"><a href=""></a><span class="co">#&gt;  5   334   1.78e- 8          512           2896</span></span>
<span id="cb42-16"><a href=""></a><span class="co">#&gt;  6   417   1.33e- 3          322           1625</span></span>
<span id="cb42-17"><a href=""></a><span class="co">#&gt;  7   500   1   e- 1         1448           1149</span></span>
<span id="cb42-18"><a href=""></a><span class="co">#&gt;  8   584   1   e- 7         1290            256</span></span>
<span id="cb42-19"><a href=""></a><span class="co">#&gt;  9   667   2.37e-10          456            724</span></span>
<span id="cb42-20"><a href=""></a><span class="co">#&gt; 10   750   1.78e- 2          645            322</span></span>
<span id="cb42-21"><a href=""></a><span class="co">#&gt; # ℹ 15 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">

</div>
</section>
<section id="your-turn-4" class="slide level2" data-transition="slide-in">
<h2>Your turn</h2>
<p><img data-src="images/parsnip-flagger.jpg" class="absolute" style="top: 0px; right: 0px; width: 150px; height: 150px; "></p>
<p><em>Create a grid for our tunable workflow.</em></p>
<p><em>Try creating a regular grid.</em></p>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="make-grid" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">−</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
<div class="footer">

</div>
</section>
<section id="create-a-regular-grid" class="slide level2">
<h2>Create a regular grid <img data-src="hexes/workflows.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/dials.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb43" data-code-line-numbers="5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">12</span>)</span>
<span id="cb43-2"><a href=""></a>grid <span class="ot">&lt;-</span> </span>
<span id="cb43-3"><a href=""></a>  lgbm_wflow <span class="sc">%&gt;%</span> </span>
<span id="cb43-4"><a href=""></a>  <span class="fu">extract_parameter_set_dials</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb43-5"><a href=""></a>  <span class="fu">grid_regular</span>(<span class="at">levels =</span> <span class="dv">4</span>)</span>
<span id="cb43-6"><a href=""></a></span>
<span id="cb43-7"><a href=""></a>grid</span>
<span id="cb43-8"><a href=""></a><span class="co">#&gt; # A tibble: 256 × 4</span></span>
<span id="cb43-9"><a href=""></a><span class="co">#&gt;    trees   learn_rate `agent hash` `company hash`</span></span>
<span id="cb43-10"><a href=""></a><span class="co">#&gt;    &lt;int&gt;        &lt;dbl&gt;        &lt;int&gt;          &lt;int&gt;</span></span>
<span id="cb43-11"><a href=""></a><span class="co">#&gt;  1     1 0.0000000001          256            256</span></span>
<span id="cb43-12"><a href=""></a><span class="co">#&gt;  2   667 0.0000000001          256            256</span></span>
<span id="cb43-13"><a href=""></a><span class="co">#&gt;  3  1333 0.0000000001          256            256</span></span>
<span id="cb43-14"><a href=""></a><span class="co">#&gt;  4  2000 0.0000000001          256            256</span></span>
<span id="cb43-15"><a href=""></a><span class="co">#&gt;  5     1 0.0000001             256            256</span></span>
<span id="cb43-16"><a href=""></a><span class="co">#&gt;  6   667 0.0000001             256            256</span></span>
<span id="cb43-17"><a href=""></a><span class="co">#&gt;  7  1333 0.0000001             256            256</span></span>
<span id="cb43-18"><a href=""></a><span class="co">#&gt;  8  2000 0.0000001             256            256</span></span>
<span id="cb43-19"><a href=""></a><span class="co">#&gt;  9     1 0.0001                256            256</span></span>
<span id="cb43-20"><a href=""></a><span class="co">#&gt; 10   667 0.0001                256            256</span></span>
<span id="cb43-21"><a href=""></a><span class="co">#&gt; # ℹ 246 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">

</div>
</section>
<section id="your-turn-5" class="slide level2" data-transition="slide-in">
<h2>Your turn</h2>
<p><img data-src="images/parsnip-flagger.jpg" class="absolute" style="top: 0px; right: 0px; width: 150px; height: 150px; "></p>
<p><br></p>
<p><em>What advantage would a regular grid have?</em></p>
<aside class="notes">
<ul>
<li>Systematic Coverage of the Hyperparameter Space</li>
<li>Reproducibility</li>
<li>Interpretability: easier to visualize and compare results</li>
<li>Good for Low-Dimensional Spaces</li>
<li>Easy to Debug: because it covers every combination evenly, you can detect:
<ul>
<li>Flat regions (no performance change)</li>
<li>Interactions between parameters</li>
<li>This helps in model diagnostics and feature understanding.</li>
</ul></li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="footer">

</div>
</section>
<section id="update-parameter-ranges" class="slide level2 annotation">
<h2>Update parameter ranges <img data-src="hexes/workflows.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/dials.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb44" data-code-line-numbers="4-5|"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href=""></a>lgbm_param <span class="ot">&lt;-</span> </span>
<span id="cb44-2"><a href=""></a>  lgbm_wflow <span class="sc">%&gt;%</span> </span>
<span id="cb44-3"><a href=""></a>  <span class="fu">extract_parameter_set_dials</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb44-4"><a href=""></a>  <span class="fu">update</span>(<span class="at">trees =</span> <span class="fu">trees</span>(<span class="fu">c</span>(<span class="dv">1</span>L, <span class="dv">100</span>L)),</span>
<span id="cb44-5"><a href=""></a>         <span class="at">learn_rate =</span> <span class="fu">learn_rate</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="sc">-</span><span class="dv">1</span>)))</span>
<span id="cb44-6"><a href=""></a></span>
<span id="cb44-7"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">712</span>)</span>
<span id="cb44-8"><a href=""></a>grid <span class="ot">&lt;-</span> </span>
<span id="cb44-9"><a href=""></a>  lgbm_param <span class="sc">%&gt;%</span> </span>
<span id="cb44-10"><a href=""></a>  <span class="fu">grid_space_filling</span>(<span class="at">size =</span> <span class="dv">25</span>)</span>
<span id="cb44-11"><a href=""></a></span>
<span id="cb44-12"><a href=""></a>grid</span>
<span id="cb44-13"><a href=""></a><span class="co">#&gt; # A tibble: 25 × 4</span></span>
<span id="cb44-14"><a href=""></a><span class="co">#&gt;    trees learn_rate `agent hash` `company hash`</span></span>
<span id="cb44-15"><a href=""></a><span class="co">#&gt;    &lt;int&gt;      &lt;dbl&gt;        &lt;int&gt;          &lt;int&gt;</span></span>
<span id="cb44-16"><a href=""></a><span class="co">#&gt;  1     1  0.00147            574            574</span></span>
<span id="cb44-17"><a href=""></a><span class="co">#&gt;  2     5  0.00215           2048           2298</span></span>
<span id="cb44-18"><a href=""></a><span class="co">#&gt;  3     9  0.0000215         1824            912</span></span>
<span id="cb44-19"><a href=""></a><span class="co">#&gt;  4    13  0.00316           3250            512</span></span>
<span id="cb44-20"><a href=""></a><span class="co">#&gt;  5    17  0.0001             512           2896</span></span>
<span id="cb44-21"><a href=""></a><span class="co">#&gt;  6    21  0.0147             322           1625</span></span>
<span id="cb44-22"><a href=""></a><span class="co">#&gt;  7    25  0.1               1448           1149</span></span>
<span id="cb44-23"><a href=""></a><span class="co">#&gt;  8    29  0.000215          1290            256</span></span>
<span id="cb44-24"><a href=""></a><span class="co">#&gt;  9    34  0.0000147          456            724</span></span>
<span id="cb44-25"><a href=""></a><span class="co">#&gt; 10    38  0.0464             645            322</span></span>
<span id="cb44-26"><a href=""></a><span class="co">#&gt; # ℹ 15 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">

</div>
</section>
<section id="the-results" class="slide level2">
<h2>The results <img data-src="hexes/ggplot2.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/dials.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "></h2>
<div class="cell columns column-output-location" data-layout-align="center">
<div class="column">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href=""></a>grid <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href=""></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(trees, learn_rate)) <span class="sc">+</span></span>
<span id="cb45-3"><a href=""></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb45-4"><a href=""></a>  <span class="fu">scale_y_log10</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="part-II_files/figure-revealjs/sfd-1.svg" class="quarto-figure quarto-figure-center" style="width:70.0%"></p>
</figure>
</div>
</div>
</div></div>
<p>Note that the learning rates are uniform on the log-10 scale and this shows 2 of 4 dimensions.</p>
<aside class="notes">
<ul>
<li>When you used learn_rate(c(-5, -1)), that defined a range from:</li>
<li>10^{-5} = 0.00001 to 10^{-1} = 0.1</li>
<li>grid_space_filling() spread values evenly in log scale, not linear scale.</li>
<li>So you get good coverage across orders of magnitude, not just dense values near 0.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="footer">

</div>
</section></section>
<section>
<section id="use-the-tune_-functions-to-tune-models" class="title-slide slide level1 center">
<h1>Use the <code>tune_*()</code> functions to tune models</h1>
<div class="footer">

</div>
</section>
<section id="choosing-tuning-parameters" class="slide level2">
<h2>Choosing tuning parameters <img data-src="hexes/workflows.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/tune.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "> <img data-src="hexes/recipes.png" class="absolute" style="top: -20px; right: 128px; width: 64px; height: 74.24px; "> <img data-src="hexes/parsnip.png" class="absolute" style="top: -20px; right: 192px; width: 64px; height: 74.24px; "> <img data-src="hexes/bonsai.png" class="absolute" style="top: -20px; right: 256px; width: 64px; height: 74.24px; "></h2>
<p>Let’s take our previous model and tune more parameters:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46" data-code-line-numbers="2,12-13|"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href=""></a>lgbm_spec <span class="ot">&lt;-</span> </span>
<span id="cb46-2"><a href=""></a>  <span class="fu">boost_tree</span>(<span class="at">trees =</span> <span class="fu">tune</span>(), <span class="at">learn_rate =</span> <span class="fu">tune</span>(),  <span class="at">min_n =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb46-3"><a href=""></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb46-4"><a href=""></a>  <span class="fu">set_engine</span>(<span class="st">"lightgbm"</span>, <span class="at">num_threads =</span> <span class="dv">1</span>)</span>
<span id="cb46-5"><a href=""></a></span>
<span id="cb46-6"><a href=""></a>lgbm_wflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>(hash_rec, lgbm_spec)</span>
<span id="cb46-7"><a href=""></a></span>
<span id="cb46-8"><a href=""></a><span class="co"># Update the feature hash ranges (log-2 units)</span></span>
<span id="cb46-9"><a href=""></a>lgbm_param <span class="ot">&lt;-</span></span>
<span id="cb46-10"><a href=""></a>  lgbm_wflow <span class="sc">%&gt;%</span></span>
<span id="cb46-11"><a href=""></a>  <span class="fu">extract_parameter_set_dials</span>() <span class="sc">%&gt;%</span></span>
<span id="cb46-12"><a href=""></a>  <span class="fu">update</span>(<span class="st">`</span><span class="at">agent hash</span><span class="st">`</span>   <span class="ot">=</span> <span class="fu">num_hash</span>(<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">8</span>)),</span>
<span id="cb46-13"><a href=""></a>         <span class="st">`</span><span class="at">company hash</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">num_hash</span>(<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">8</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<aside class="notes">
<p>trees = tune() you’re telling tidymodels to tune the number of boosting rounds (trees).</p>
<pre><code>-   Controls how many trees are built
-   More trees = potentially better fit, but more overfitting risk and time</code></pre>
<p>learn_rate = tune() you’ll tune the learning rate (how much each tree contributes to the final model).</p>
<pre><code>-   Smaller = slower learning, better generalization
- Larger = faster, but more risk of overshooting or overfitting</code></pre>
<p>min_n = tune() You’ll tune the minimum number of data points required in a leaf. - Controls complexity of trees - Larger = simpler trees (less overfitting) - Smaller = more complex trees (risk of overfitting)</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="footer">

</div>
</section>
<section id="grid-search-3" class="slide level2">
<h2>Grid Search <img data-src="hexes/workflows.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/tune.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "> <img data-src="hexes/dials.png" class="absolute" style="top: -20px; right: 128px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb49" data-code-line-numbers="2|"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">9</span>)</span>
<span id="cb49-2"><a href=""></a>ctrl <span class="ot">&lt;-</span> <span class="fu">control_grid</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>)</span>
<span id="cb49-3"><a href=""></a></span>
<span id="cb49-4"><a href=""></a>lgbm_res <span class="ot">&lt;-</span></span>
<span id="cb49-5"><a href=""></a>  lgbm_wflow <span class="sc">%&gt;%</span></span>
<span id="cb49-6"><a href=""></a>  <span class="fu">tune_grid</span>(</span>
<span id="cb49-7"><a href=""></a>    <span class="at">resamples =</span> hotel_rs,</span>
<span id="cb49-8"><a href=""></a>    <span class="at">grid =</span> <span class="dv">25</span>,</span>
<span id="cb49-9"><a href=""></a>    <span class="co"># The options below are not required by default</span></span>
<span id="cb49-10"><a href=""></a>    <span class="at">param_info =</span> lgbm_param, </span>
<span id="cb49-11"><a href=""></a>    <span class="at">control =</span> ctrl,</span>
<span id="cb49-12"><a href=""></a>    <span class="at">metrics =</span> reg_metrics</span>
<span id="cb49-13"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<aside class="notes">
<ul>
<li><code>tune_grid()</code> is representative of tuning function syntax</li>
<li>similar to <code>fit_resamples()</code></li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="footer">

</div>
</section>
<section id="grid-search-4" class="slide level2">
<h2>Grid Search <img data-src="hexes/workflows.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/tune.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "> <img data-src="hexes/dials.png" class="absolute" style="top: -20px; right: 128px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href=""></a>lgbm_res </span>
<span id="cb50-2"><a href=""></a><span class="co">#&gt; # Tuning results</span></span>
<span id="cb50-3"><a href=""></a><span class="co">#&gt; # 10-fold cross-validation using stratification </span></span>
<span id="cb50-4"><a href=""></a><span class="co">#&gt; # A tibble: 10 × 5</span></span>
<span id="cb50-5"><a href=""></a><span class="co">#&gt;    splits             id     .metrics          .notes           .predictions        </span></span>
<span id="cb50-6"><a href=""></a><span class="co">#&gt;    &lt;list&gt;             &lt;chr&gt;  &lt;list&gt;            &lt;list&gt;           &lt;list&gt;              </span></span>
<span id="cb50-7"><a href=""></a><span class="co">#&gt;  1 &lt;split [3372/377]&gt; Fold01 &lt;tibble [50 × 9]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [9,425 × 9]&gt;</span></span>
<span id="cb50-8"><a href=""></a><span class="co">#&gt;  2 &lt;split [3373/376]&gt; Fold02 &lt;tibble [50 × 9]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [9,400 × 9]&gt;</span></span>
<span id="cb50-9"><a href=""></a><span class="co">#&gt;  3 &lt;split [3373/376]&gt; Fold03 &lt;tibble [50 × 9]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [9,400 × 9]&gt;</span></span>
<span id="cb50-10"><a href=""></a><span class="co">#&gt;  4 &lt;split [3373/376]&gt; Fold04 &lt;tibble [50 × 9]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [9,400 × 9]&gt;</span></span>
<span id="cb50-11"><a href=""></a><span class="co">#&gt;  5 &lt;split [3373/376]&gt; Fold05 &lt;tibble [50 × 9]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [9,400 × 9]&gt;</span></span>
<span id="cb50-12"><a href=""></a><span class="co">#&gt;  6 &lt;split [3374/375]&gt; Fold06 &lt;tibble [50 × 9]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [9,375 × 9]&gt;</span></span>
<span id="cb50-13"><a href=""></a><span class="co">#&gt;  7 &lt;split [3375/374]&gt; Fold07 &lt;tibble [50 × 9]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [9,350 × 9]&gt;</span></span>
<span id="cb50-14"><a href=""></a><span class="co">#&gt;  8 &lt;split [3376/373]&gt; Fold08 &lt;tibble [50 × 9]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [9,325 × 9]&gt;</span></span>
<span id="cb50-15"><a href=""></a><span class="co">#&gt;  9 &lt;split [3376/373]&gt; Fold09 &lt;tibble [50 × 9]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [9,325 × 9]&gt;</span></span>
<span id="cb50-16"><a href=""></a><span class="co">#&gt; 10 &lt;split [3376/373]&gt; Fold10 &lt;tibble [50 × 9]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [9,325 × 9]&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">

</div>
</section>
<section id="grid-results" class="slide level2">
<h2>Grid results <img data-src="hexes/tune.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href=""></a><span class="fu">autoplot</span>(lgbm_res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="part-II_files/figure-revealjs/autoplot-1.svg" class="quarto-figure quarto-figure-center" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<aside class="notes">
<ol type="1">
<li><h1 id="trees">Trees</h1>
<p>mae: Best performance clusters at higher tree counts (around 1500–2000). rsq: Same pattern — higher tree counts give better fit (higher R²).</p></li>
<li><p>agent hash (log-2) mae and rsq: Performance is fairly stable once hash size is large enough (log2 ≈ 9–11 → 512–2048 buckets). Bigger hash spaces seem to help a little but reach diminishing returns.</p></li>
<li><p>company hash (log-2) Similar to agent hash, though with slightly more variation. Mid-to-high hash sizes (log2 ≈ 8–11) seem to perform better. Very low hash sizes (e.g., 8 or 16) likely lead to too many collisions → worse performance.</p></li>
<li><p>Learning Rate (log-10) Lower values (log10 ≈ -5 to -2 → learning rates between 1e-5 to 1e-2) give better MAE and R². Slower learning = better generalization Larger learning rates (closer to 0.1 or log10 = -1) tend to overfit or overshoot</p></li>
<li><p>Minimal Node Size (min_n) Low values (small leaves) seem to increase variance in performance. Moderate to higher values (10–30) result in more stable performance. Very low values (e.g., 1) likely overfit → worse MAE and R²</p></li>
</ol>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="footer">

</div>
</section>
<section id="tuning-results" class="slide level2">
<h2>Tuning results <img data-src="hexes/tune.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href=""></a><span class="fu">collect_metrics</span>(lgbm_res)</span>
<span id="cb52-2"><a href=""></a><span class="co">#&gt; # A tibble: 50 × 11</span></span>
<span id="cb52-3"><a href=""></a><span class="co">#&gt;    trees min_n    learn_rate `agent hash` `company hash` .metric .estimator   mean     n std_err .config              </span></span>
<span id="cb52-4"><a href=""></a><span class="co">#&gt;    &lt;int&gt; &lt;int&gt;         &lt;dbl&gt;        &lt;int&gt;          &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                </span></span>
<span id="cb52-5"><a href=""></a><span class="co">#&gt;  1     1    17 0.00000000133           93             25 mae     standard   53.2      10 0.427   Preprocessor01_Model1</span></span>
<span id="cb52-6"><a href=""></a><span class="co">#&gt;  2     1    17 0.00000000133           93             25 rsq     standard    0.810    10 0.00746 Preprocessor01_Model1</span></span>
<span id="cb52-7"><a href=""></a><span class="co">#&gt;  3    84    27 0.0178                  80             69 mae     standard   20.0      10 0.293   Preprocessor02_Model1</span></span>
<span id="cb52-8"><a href=""></a><span class="co">#&gt;  4    84    27 0.0178                  80             69 rsq     standard    0.897    10 0.00423 Preprocessor02_Model1</span></span>
<span id="cb52-9"><a href=""></a><span class="co">#&gt;  5   167    19 0.00000133              12            143 mae     standard   53.2      10 0.426   Preprocessor03_Model1</span></span>
<span id="cb52-10"><a href=""></a><span class="co">#&gt;  6   167    19 0.00000133              12            143 rsq     standard    0.811    10 0.00698 Preprocessor03_Model1</span></span>
<span id="cb52-11"><a href=""></a><span class="co">#&gt;  7   250     2 0.000237                33             33 mae     standard   50.6      10 0.409   Preprocessor04_Model1</span></span>
<span id="cb52-12"><a href=""></a><span class="co">#&gt;  8   250     2 0.000237                33             33 rsq     standard    0.815    10 0.00800 Preprocessor04_Model1</span></span>
<span id="cb52-13"><a href=""></a><span class="co">#&gt;  9   334    36 0.0000000178            19             21 mae     standard   53.2      10 0.427   Preprocessor05_Model1</span></span>
<span id="cb52-14"><a href=""></a><span class="co">#&gt; 10   334    36 0.0000000178            19             21 rsq     standard    0.807    10 0.00692 Preprocessor05_Model1</span></span>
<span id="cb52-15"><a href=""></a><span class="co">#&gt; # ℹ 40 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">

</div>
</section>
<section id="tuning-results-1" class="slide level2">
<h2>Tuning results <img data-src="hexes/tune.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href=""></a><span class="fu">collect_metrics</span>(lgbm_res, <span class="at">summarize =</span> <span class="cn">FALSE</span>)</span>
<span id="cb53-2"><a href=""></a><span class="co">#&gt; # A tibble: 500 × 10</span></span>
<span id="cb53-3"><a href=""></a><span class="co">#&gt;    id     trees min_n    learn_rate `agent hash` `company hash` .metric .estimator .estimate .config              </span></span>
<span id="cb53-4"><a href=""></a><span class="co">#&gt;    &lt;chr&gt;  &lt;int&gt; &lt;int&gt;         &lt;dbl&gt;        &lt;int&gt;          &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;                </span></span>
<span id="cb53-5"><a href=""></a><span class="co">#&gt;  1 Fold01     1    17 0.00000000133           93             25 mae     standard      51.8   Preprocessor01_Model1</span></span>
<span id="cb53-6"><a href=""></a><span class="co">#&gt;  2 Fold01     1    17 0.00000000133           93             25 rsq     standard       0.821 Preprocessor01_Model1</span></span>
<span id="cb53-7"><a href=""></a><span class="co">#&gt;  3 Fold02     1    17 0.00000000133           93             25 mae     standard      52.1   Preprocessor01_Model1</span></span>
<span id="cb53-8"><a href=""></a><span class="co">#&gt;  4 Fold02     1    17 0.00000000133           93             25 rsq     standard       0.810 Preprocessor01_Model1</span></span>
<span id="cb53-9"><a href=""></a><span class="co">#&gt;  5 Fold03     1    17 0.00000000133           93             25 mae     standard      52.2   Preprocessor01_Model1</span></span>
<span id="cb53-10"><a href=""></a><span class="co">#&gt;  6 Fold03     1    17 0.00000000133           93             25 rsq     standard       0.783 Preprocessor01_Model1</span></span>
<span id="cb53-11"><a href=""></a><span class="co">#&gt;  7 Fold04     1    17 0.00000000133           93             25 mae     standard      51.7   Preprocessor01_Model1</span></span>
<span id="cb53-12"><a href=""></a><span class="co">#&gt;  8 Fold04     1    17 0.00000000133           93             25 rsq     standard       0.815 Preprocessor01_Model1</span></span>
<span id="cb53-13"><a href=""></a><span class="co">#&gt;  9 Fold05     1    17 0.00000000133           93             25 mae     standard      55.2   Preprocessor01_Model1</span></span>
<span id="cb53-14"><a href=""></a><span class="co">#&gt; 10 Fold05     1    17 0.00000000133           93             25 rsq     standard       0.847 Preprocessor01_Model1</span></span>
<span id="cb53-15"><a href=""></a><span class="co">#&gt; # ℹ 490 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">

</div>
</section>
<section id="choose-a-parameter-combination" class="slide level2">
<h2>Choose a parameter combination <img data-src="hexes/tune.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href=""></a><span class="fu">show_best</span>(lgbm_res, <span class="at">metric =</span> <span class="st">"rsq"</span>)</span>
<span id="cb54-2"><a href=""></a><span class="co">#&gt; # A tibble: 5 × 11</span></span>
<span id="cb54-3"><a href=""></a><span class="co">#&gt;   trees min_n learn_rate `agent hash` `company hash` .metric .estimator  mean     n std_err .config              </span></span>
<span id="cb54-4"><a href=""></a><span class="co">#&gt;   &lt;int&gt; &lt;int&gt;      &lt;dbl&gt;        &lt;int&gt;          &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                </span></span>
<span id="cb54-5"><a href=""></a><span class="co">#&gt; 1  1250     9    0.1              107             80 rsq     standard   0.947    10 0.00395 Preprocessor16_Model1</span></span>
<span id="cb54-6"><a href=""></a><span class="co">#&gt; 2   917    16    0.0422             9             39 rsq     standard   0.946    10 0.00362 Preprocessor12_Model1</span></span>
<span id="cb54-7"><a href=""></a><span class="co">#&gt; 3  1666    30    0.00750          124             19 rsq     standard   0.943    10 0.00309 Preprocessor21_Model1</span></span>
<span id="cb54-8"><a href=""></a><span class="co">#&gt; 4  2000    24    0.00133           25            124 rsq     standard   0.919    10 0.00383 Preprocessor25_Model1</span></span>
<span id="cb54-9"><a href=""></a><span class="co">#&gt; 5   500    25    0.00316           52              8 rsq     standard   0.899    10 0.00435 Preprocessor07_Model1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">

</div>
</section>
<section id="choose-a-parameter-combination-1" class="slide level2">
<h2>Choose a parameter combination <img data-src="hexes/tune.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<p>Create your own tibble for final parameters or use one of the <code>tune::select_*()</code> functions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href=""></a>lgbm_best <span class="ot">&lt;-</span> <span class="fu">select_best</span>(lgbm_res, <span class="at">metric =</span> <span class="st">"mae"</span>)</span>
<span id="cb55-2"><a href=""></a>lgbm_best</span>
<span id="cb55-3"><a href=""></a><span class="co">#&gt; # A tibble: 1 × 6</span></span>
<span id="cb55-4"><a href=""></a><span class="co">#&gt;   trees min_n learn_rate `agent hash` `company hash` .config              </span></span>
<span id="cb55-5"><a href=""></a><span class="co">#&gt;   &lt;int&gt; &lt;int&gt;      &lt;dbl&gt;        &lt;int&gt;          &lt;int&gt; &lt;chr&gt;                </span></span>
<span id="cb55-6"><a href=""></a><span class="co">#&gt; 1  1250     9        0.1          107             80 Preprocessor16_Model1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">

</div>
</section>
<section id="checking-calibration" class="slide level2">
<h2>Checking Calibration <img data-src="hexes/tune.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/probably.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "></h2>
<div class="cell columns column-output-location">
<div class="column">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href=""></a><span class="fu">library</span>(probably)</span>
<span id="cb56-2"><a href=""></a>lgbm_res <span class="sc">%&gt;%</span></span>
<span id="cb56-3"><a href=""></a>  <span class="fu">collect_predictions</span>(</span>
<span id="cb56-4"><a href=""></a>    <span class="at">parameters =</span> lgbm_best</span>
<span id="cb56-5"><a href=""></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb56-6"><a href=""></a>  <span class="fu">cal_plot_regression</span>(</span>
<span id="cb56-7"><a href=""></a>    <span class="at">truth =</span> avg_price_per_room,</span>
<span id="cb56-8"><a href=""></a>    <span class="at">estimate =</span> .pred</span>
<span id="cb56-9"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="part-II_files/figure-revealjs/lgb-cal-plot-1.svg" style="width:90.0%"></p>
</figure>
</div>
</div>
</div></div>
<aside class="notes">
<p>X-axis: Predicted values (.pred) Y-axis: Observed values (avg_price_per_room) A diagonal line representing perfect calibration (predicted = observed) A smoothed curve or points showing how predictions deviate from the actual values</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="footer">

</div>
</section>
<section id="running-in-parallel" class="slide level2">
<h2>Running in parallel</h2>
<div class="columns">
<div class="column" style="width:60%;">
<ul>
<li><p>Grid search, combined with resampling, requires fitting a lot of models!</p></li>
<li><p>These models don’t depend on one another and can be run in parallel.</p></li>
</ul>
<p>We can use a <em>parallel backend</em> to do this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href=""></a>cores <span class="ot">&lt;-</span> parallelly<span class="sc">::</span><span class="fu">availableCores</span>(<span class="at">logical =</span> <span class="cn">FALSE</span>)</span>
<span id="cb57-2"><a href=""></a>cl <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">makePSOCKcluster</span>(cores)</span>
<span id="cb57-3"><a href=""></a>doParallel<span class="sc">::</span><span class="fu">registerDoParallel</span>(cl)</span>
<span id="cb57-4"><a href=""></a></span>
<span id="cb57-5"><a href=""></a><span class="co"># Now call `tune_grid()`!</span></span>
<span id="cb57-6"><a href=""></a></span>
<span id="cb57-7"><a href=""></a><span class="co"># Shut it down with:</span></span>
<span id="cb57-8"><a href=""></a>foreach<span class="sc">::</span><span class="fu">registerDoSEQ</span>()</span>
<span id="cb57-9"><a href=""></a>parallel<span class="sc">::</span><span class="fu">stopCluster</span>(cl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:40%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="part-II_files/figure-revealjs/resample-times-1.svg" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
<div class="footer">

</div>
</section>
<section id="running-in-parallel-1" class="slide level2">
<h2>Running in parallel</h2>
<p>Speed-ups are fairly linear up to the number of physical cores (10 here).</p>

<img data-src="part-II_files/figure-revealjs/parallel-speedup-1.svg" class="quarto-figure quarto-figure-center r-stretch" style="width:90.0%"><aside class="notes">
<p>-X-axis: Number of workers (i.e., CPU cores used in parallel) - Y-axis: Speed-up — how many times faster the tuning is compared to using 1 core</p>
<p>A perfect line (black diagonal) means linear speed-up: → 2 workers = 2× faster, 4 workers = 4× faster, etc.</p>
<p>Faceted on the expensiveness of preprocessing used. Each panel represents a different model complexity or workload type:</p>
<pre><code>1.  none – Models that are very cheap/fast to train
2.  light – Models that are moderately expensive
3.  expensive – Models that are very computationally intensive</code></pre>
<p>• 🟢 Green circles (“everything”): Parallelization is done over both resamples and tuning grid combinations • 🔷 Blue triangles (“resamples”): Parallelization is done only over resamples (e.g., CV folds)</p>
<p>Interpretation:</p>
<pre><code>•   Expensive models (right panel) benefit the most from parallelism — you get up to 9× speed-up with 20 workers
•   Lightweight or fast models don’t benefit much after a few cores — overhead outweighs the gains
•   Parallelizing everything (green) tends to outperform or match parallelizing just resamples (blue)</code></pre>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="footer">

</div>
</section>
<section id="early-stopping-for-boosted-trees" class="slide level2 annotation">
<h2>Early stopping for boosted trees</h2>
<p>We have directly optimized the number of trees as a tuning parameter.</p>
<p>Instead we could</p>
<ul>
<li>Set the number of trees to a single large number.</li>
<li>Stop adding trees when performance gets worse.</li>
</ul>
<p>This is known as “early stopping” and there is a parameter for that: <code>stop_iter</code>.</p>
<p>Early stopping has a potential to decrease the tuning time.</p>
<div class="footer">

</div>
</section>
<section id="your-turn-6" class="slide level2" data-transition="slide-in">
<h2>Your turn</h2>
<p><img data-src="images/parsnip-flagger.jpg" class="absolute" style="top: 0px; right: 0px; width: 150px; height: 150px; "></p>
<p><br></p>
<p><em>Set <code>trees = 2000</code> and tune the <code>stop_iter</code> parameter.</em></p>
<p>Note that you will need to regenerate <code>lgbm_param</code> with your new workflow!</p>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="lgbm-stop" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">−</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
<div class="footer">

</div>
</section></section>
<section>
<section id="open-worksheet-3" class="title-slide slide level1 center">
<h1>Open Worksheet 3 📄</h1>
<div class="footer">

</div>
<div class="footer">

</div>
</section>
<section id="previously---setup-2" class="slide level2">
<h2>Previously - Setup <img data-src="hexes/tidymodels.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href=""></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb60-2"><a href=""></a><span class="fu">library</span>(textrecipes)</span>
<span id="cb60-3"><a href=""></a><span class="fu">library</span>(bonsai)</span>
<span id="cb60-4"><a href=""></a></span>
<span id="cb60-5"><a href=""></a><span class="co"># extra settings: </span></span>
<span id="cb60-6"><a href=""></a><span class="fu">tidymodels_prefer</span>()</span>
<span id="cb60-7"><a href=""></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())</span>
<span id="cb60-8"><a href=""></a><span class="fu">options</span>(</span>
<span id="cb60-9"><a href=""></a>  <span class="at">pillar.advice =</span> <span class="cn">FALSE</span>, </span>
<span id="cb60-10"><a href=""></a>  <span class="at">pillar.min_title_chars =</span> <span class="cn">Inf</span></span>
<span id="cb60-11"><a href=""></a>)</span>
<span id="cb60-12"><a href=""></a></span>
<span id="cb60-13"><a href=""></a>reg_metrics <span class="ot">&lt;-</span> <span class="fu">metric_set</span>(mae, rsq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href=""></a><span class="fu">data</span>(hotel_rates)</span>
<span id="cb61-2"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">295</span>)</span>
<span id="cb61-3"><a href=""></a>hotel_rates <span class="ot">&lt;-</span> </span>
<span id="cb61-4"><a href=""></a>  hotel_rates <span class="sc">%&gt;%</span> </span>
<span id="cb61-5"><a href=""></a>  <span class="fu">sample_n</span>(<span class="dv">5000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb61-6"><a href=""></a>  <span class="fu">arrange</span>(arrival_date) <span class="sc">%&gt;%</span> </span>
<span id="cb61-7"><a href=""></a>  <span class="fu">select</span>(<span class="sc">-</span>arrival_date) <span class="sc">%&gt;%</span> </span>
<span id="cb61-8"><a href=""></a>  <span class="fu">mutate</span>(</span>
<span id="cb61-9"><a href=""></a>    <span class="at">company =</span> <span class="fu">factor</span>(<span class="fu">as.character</span>(company)),</span>
<span id="cb61-10"><a href=""></a>    <span class="at">country =</span> <span class="fu">factor</span>(<span class="fu">as.character</span>(country)),</span>
<span id="cb61-11"><a href=""></a>    <span class="at">agent =</span> <span class="fu">factor</span>(<span class="fu">as.character</span>(agent))</span>
<span id="cb61-12"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div></div>
<div class="footer">

</div>
</section>
<section id="previously---data-usage-2" class="slide level2">
<h2>Previously - Data Usage <img data-src="hexes/rsample.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">4028</span>)</span>
<span id="cb62-2"><a href=""></a>hotel_split <span class="ot">&lt;-</span></span>
<span id="cb62-3"><a href=""></a>  <span class="fu">initial_split</span>(hotel_rates, <span class="at">strata =</span> avg_price_per_room)</span>
<span id="cb62-4"><a href=""></a></span>
<span id="cb62-5"><a href=""></a>hotel_train <span class="ot">&lt;-</span> <span class="fu">training</span>(hotel_split)</span>
<span id="cb62-6"><a href=""></a>hotel_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(hotel_split)</span>
<span id="cb62-7"><a href=""></a></span>
<span id="cb62-8"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">472</span>)</span>
<span id="cb62-9"><a href=""></a>hotel_rs <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(hotel_train, <span class="at">strata =</span> avg_price_per_room)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">

</div>
</section>
<section id="previously---boosting-model" class="slide level2">
<h2>Previously - Boosting Model <img data-src="hexes/tune.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/textrecipes.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "> <img data-src="hexes/recipes.png" class="absolute" style="top: -20px; right: 128px; width: 64px; height: 74.24px; "> <img data-src="hexes/bonsai.png" class="absolute" style="top: -20px; right: 192px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href=""></a>hotel_rec <span class="ot">&lt;-</span></span>
<span id="cb63-2"><a href=""></a>  <span class="fu">recipe</span>(avg_price_per_room <span class="sc">~</span> ., <span class="at">data =</span> hotel_train) <span class="sc">%&gt;%</span></span>
<span id="cb63-3"><a href=""></a>  <span class="fu">step_YeoJohnson</span>(lead_time) <span class="sc">%&gt;%</span></span>
<span id="cb63-4"><a href=""></a>  <span class="fu">step_dummy_hash</span>(agent,   <span class="at">num_terms =</span> <span class="fu">tune</span>(<span class="st">"agent hash"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb63-5"><a href=""></a>  <span class="fu">step_dummy_hash</span>(company, <span class="at">num_terms =</span> <span class="fu">tune</span>(<span class="st">"company hash"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb63-6"><a href=""></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>())</span>
<span id="cb63-7"><a href=""></a></span>
<span id="cb63-8"><a href=""></a>lgbm_spec <span class="ot">&lt;-</span> </span>
<span id="cb63-9"><a href=""></a>  <span class="fu">boost_tree</span>(<span class="at">trees =</span> <span class="fu">tune</span>(), <span class="at">learn_rate =</span> <span class="fu">tune</span>(), <span class="at">min_n =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb63-10"><a href=""></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb63-11"><a href=""></a>  <span class="fu">set_engine</span>(<span class="st">"lightgbm"</span>, <span class="at">num_threads =</span> <span class="dv">1</span>)</span>
<span id="cb63-12"><a href=""></a></span>
<span id="cb63-13"><a href=""></a>lgbm_wflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>(hotel_rec, lgbm_spec)</span>
<span id="cb63-14"><a href=""></a></span>
<span id="cb63-15"><a href=""></a>lgbm_param <span class="ot">&lt;-</span></span>
<span id="cb63-16"><a href=""></a>  lgbm_wflow <span class="sc">%&gt;%</span></span>
<span id="cb63-17"><a href=""></a>  <span class="fu">extract_parameter_set_dials</span>() <span class="sc">%&gt;%</span></span>
<span id="cb63-18"><a href=""></a>  <span class="fu">update</span>(<span class="st">`</span><span class="at">agent hash</span><span class="st">`</span>   <span class="ot">=</span> <span class="fu">num_hash</span>(<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">8</span>)),</span>
<span id="cb63-19"><a href=""></a>         <span class="st">`</span><span class="at">company hash</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">num_hash</span>(<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">8</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">

</div>
</section>
<section id="making-grid-search-more-efficient" class="slide level2">
<h2>Making Grid Search More Efficient</h2>
<p>In the last section, we evaluated 250 models (25 candidates times 10 resamples).</p>
<p>We can make this go faster using parallel processing.</p>
<p>Also, for some models, we can <em>fit</em> far fewer models than the number that are being evaluated.</p>
<ul>
<li>For boosting, a model with <code>X</code> trees can often predict on candidates with less than <code>X</code> trees.</li>
</ul>
<p>Both of these methods can lead to enormous speed-ups.</p>
<div class="footer">

</div>
</section>
<section id="model-racing" class="slide level2">
<h2>Model Racing</h2>
<p><a href="https://scholar.google.com/scholar?hl=en&amp;as_sdt=0%2C7&amp;q=+Hoeffding+racing"><em>Racing</em></a> is an old tool that we can use to go even faster.</p>
<ol type="1">
<li>Evaluate all of the candidate models but only for a few resamples.</li>
<li>Determine which candidates have a low probability of being selected.</li>
<li>Eliminate poor candidates.</li>
<li>Repeat with next resample (until no more resamples remain)</li>
</ol>
<p>This can result in fitting a small number of models.</p>
<div class="footer">

</div>
</section>
<section id="discarding-candidates" class="slide level2">
<h2>Discarding Candidates</h2>
<p>How do we eliminate tuning parameter combinations?</p>
<p>There are a few methods to do so. We’ll use one based on analysis of variance (ANOVA).</p>
<p><em>However</em>… there is typically a large difference between resamples in the results.</p>
<div class="footer">

</div>
</section>
<section id="resampling-results-non-racing" class="slide level2">
<h2>Resampling Results (Non-Racing)</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>Here are some realistic (but simulated) examples of two candidate models.</p>
<p>An error estimate is measured for each of 10 resamples.</p>
<ul>
<li>The lines connect resamples.</li>
</ul>
<p>There is usually a significant resample-to-resample effect (rank corr: 0.83).</p>
</div><div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="part-II_files/figure-revealjs/race-data-1.svg" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
<aside class="notes">
<p>This is called non-racing resampling, meaning:</p>
<ul>
<li><p>All candidates are fully evaluated on all resamples.</p></li>
<li><p>Contrast this with racing methods, which drop poor performers early to save time.</p></li>
<li><p>Each colored line represents the results of a single resample.</p></li>
<li><p>The y-axis is the model error (lower is better).</p></li>
<li><p>The x-axis shows the two model candidates.</p></li>
</ul>
<p>Each Line Connects One Resample Across Models:</p>
<ul>
<li>You see how each resample (fold) ranks the models.</li>
<li>Most lines go downward from candidate 1 to candidate 2 → indicating candidate 2 generally performs better (lower error).</li>
</ul>
<p>Resample-to-Resample Variability:</p>
<ul>
<li>Some lines are steeper or flatter than others.</li>
<li>This shows that performance varies across folds (which is expected in cross-validation).</li>
</ul>
<p>A rank correlation of 0.83 suggests a strong agreement:</p>
<ul>
<li>If candidate 2 performs better in one fold, it’s likely to perform better in most others.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="footer">

</div>
</section>
<section id="are-candidates-different" class="slide level2">
<h2>Are Candidates Different?</h2>
<p>One way to evaluate these models is to do a paired t-test</p>
<ul>
<li>or a t-test on their differences matched by resamples</li>
</ul>
<p>With <span class="math inline">\(n = 10\)</span> resamples, the confidence interval for the difference in RMSE is (0.99, 2.8), indicating that candidate number 2 has smaller error.</p>
<div class="footer">

</div>
</section>
<section id="evaluating-differences-in-candidates" class="slide level2">
<h2>Evaluating Differences in Candidates</h2>
<div class="columns">
<div class="column" style="width:40%;">
<p>What if we were to have compared the candidates while we sequentially evaluated each resample?</p>
<p>👉</p>
<p><be></be></p>
<p>One candidate shows superiority when 4 resamples have been evaluated.</p>
</div><div class="column" style="width:60%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="part-II_files/figure-revealjs/race-ci-1.svg" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
<aside class="notes">
<p>You’re seeing what happens when you evaluate candidate models incrementally, resample by resample.</p>
<p>Y-axis: error difference from best</p>
<ul>
<li>How much worse each candidate is compared to the current best.</li>
<li>0 means no difference (best performer so far).</li>
</ul>
<p>X-axis: number of resamples - As more resamples are completed (e.g., cross-validation folds), you collect better estimates.</p>
<p>Error bars</p>
<ul>
<li>Represent uncertainty around the performance difference at each step (standard error or confidence intervals).</li>
</ul>
<p>After just 4 resamples (X = 4), you already start to see a clear trend:</p>
<ul>
<li>One candidate consistently has lower error</li>
<li>Its confidence interval no longer overlaps the red line (= best so far)</li>
<li>This implies you might not need all 10 resamples to make a decision.</li>
</ul>
<p>Focuses resources on promising candidates!</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="footer">

</div>
</section>
<section id="interim-analysis-of-results" class="slide level2">
<h2>Interim Analysis of Results</h2>
<p>One version of racing uses a <em>mixed model ANOVA</em> to construct one-sided confidence intervals for each candidate versus the current best.</p>
<p>Any candidates whose bound does not include zero are discarded. <a href="https://www.tmwr.org/race_results.mp4">Here</a> is an animation.</p>
<p>The resamples are analyzed in a random order (so set the seed).</p>
<p><br></p>
<p><a href="https://arxiv.org/abs/1405.6974">Kuhn (2014)</a> has examples and simulations to show that the method works.</p>
<p>The <a href="https://finetune.tidymodels.org/">finetune</a> package has functions <code>tune_race_anova()</code> and <code>tune_race_win_loss()</code>.</p>
<aside class="notes">
<p>Instead of evaluating all candidate models across all resamples, we:</p>
<ol type="1">
<li>Evaluate resamples sequentially</li>
<li>Use a mixed model ANOVA to compare each model’s performance to the current best</li>
<li>Drop bad performers early based on a statistical rule</li>
</ol>
<p>Statistical Rule:</p>
<p>“One-sided confidence intervals” are computed for each model’s error difference vs.&nbsp;the best model.</p>
<ul>
<li><p>A two-sided CI answers: “How different could this model be, in either direction?”</p></li>
<li><p>A one-sided CI answers: “How much worse could this model be compared to the best?”</p></li>
<li><p>Focuses only on whether a model is worse, not better.</p></li>
<li><p>It’s a statistical test for inferiority.</p></li>
</ul>
<p>Let’s say we compute:</p>
<p>Mean Error of Model A - Mean Error of Best Model = <span class="math inline">\(\Delta\)</span></p>
<p>And estimate a standard error from the resamples.</p>
<p>We then construct a one-sided upper confidence interval: <span class="math inline">\(\Delta + z \cdot SE\)</span></p>
<p>If this interval is entirely greater than 0, we’re confident that Model A is worse than the best, and we can drop it.</p>
<ul>
<li>If zero is not in the interval, the model is statistically unlikely to be best</li>
<li>If zero is included, we can’t be sure — keep evaluating.</li>
</ul>
<p>Statistically principled — not just based on raw ranks or averages.</p>
<p>steps 1–2: Collect early resample results</p>
<p>steps 2+: Compute mean &amp; SE of error difference</p>
<p>Video:</p>
<ol type="1">
<li>Start: All Models In</li>
</ol>
<ul>
<li>A large number of models (e.g., 20–30 combinations of preprocessing + algorithm) are listed.</li>
<li>Each model starts off evaluated on just 1 resample.</li>
<li>All models are marked black — meaning: still under evaluation.</li>
</ul>
<ol start="2" type="1">
<li>As More Resamples Are Evaluated</li>
</ol>
<ul>
<li>Each iteration corresponds to a new fold being evaluated.</li>
<li>For each model, the plot updates:</li>
<li>The point (average loss vs.&nbsp;best model)</li>
<li>The error bar (confidence interval for that loss)</li>
</ul>
<ol start="3" type="1">
<li>One Model Becomes the Leader</li>
</ol>
<ul>
<li>The model with the lowest mean error becomes the current best (marked blue).</li>
<li>Other models’ performance is now measured as loss compared to the best (e.g., Loss of ROC AUC).</li>
</ul>
<ol start="4" type="1">
<li>Elimination Begins</li>
</ol>
<ul>
<li>Once a model’s one-sided confidence interval no longer includes 0, it is statistically worse.</li>
<li>It gets gray and disappears (dropped from further evaluation).</li>
<li>This is the essence of racing — eliminating models that clearly won’t win.</li>
</ul>
<ol start="5" type="1">
<li>End Game: Fewer Models Remaining</li>
</ol>
<ul>
<li>As resamples accumulate, uncertainty shrinks (error bars tighten).</li>
<li>Most poor-performing models are eliminated.</li>
<li>Only a handful of strong candidates remain.</li>
</ul>
<p>Eventually:</p>
<ul>
<li>One model is confirmed best</li>
<li>Other models are either retained (uncertain) or discarded</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="footer">

</div>
</section>
<section id="racing" class="slide level2">
<h2>Racing <img data-src="hexes/tune.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/textrecipes.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "> <img data-src="hexes/recipes.png" class="absolute" style="top: -20px; right: 128px; width: 64px; height: 74.24px; "> <img data-src="hexes/finetune.png" class="absolute" style="top: -20px; right: 192px; width: 64px; height: 74.24px; "> <img data-src="hexes/bonsai.png" class="absolute" style="top: -20px; right: 256px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb64" data-code-line-numbers="12|"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href=""></a><span class="co"># Let's use a larger grid</span></span>
<span id="cb64-2"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">8945</span>)</span>
<span id="cb64-3"><a href=""></a>lgbm_grid <span class="ot">&lt;-</span> </span>
<span id="cb64-4"><a href=""></a>  lgbm_param <span class="sc">%&gt;%</span> </span>
<span id="cb64-5"><a href=""></a>  <span class="fu">grid_space_filling</span>(<span class="at">size =</span> <span class="dv">50</span>)</span>
<span id="cb64-6"><a href=""></a></span>
<span id="cb64-7"><a href=""></a><span class="fu">library</span>(finetune)</span>
<span id="cb64-8"><a href=""></a></span>
<span id="cb64-9"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">9</span>)</span>
<span id="cb64-10"><a href=""></a>lgbm_race_res <span class="ot">&lt;-</span></span>
<span id="cb64-11"><a href=""></a>  lgbm_wflow <span class="sc">%&gt;%</span></span>
<span id="cb64-12"><a href=""></a>  <span class="fu">tune_race_anova</span>(</span>
<span id="cb64-13"><a href=""></a>    <span class="at">resamples =</span> hotel_rs,</span>
<span id="cb64-14"><a href=""></a>    <span class="at">grid =</span> lgbm_grid, </span>
<span id="cb64-15"><a href=""></a>    <span class="at">metrics =</span> reg_metrics</span>
<span id="cb64-16"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The syntax and helper functions are extremely similar to those shown for <code>tune_grid()</code>.</p>
<div class="footer">

</div>
</section>
<section id="racing-results" class="slide level2">
<h2>Racing Results <img data-src="hexes/tune.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href=""></a><span class="fu">show_best</span>(lgbm_race_res, <span class="at">metric =</span> <span class="st">"mae"</span>)</span>
<span id="cb65-2"><a href=""></a><span class="co">#&gt; # A tibble: 2 × 11</span></span>
<span id="cb65-3"><a href=""></a><span class="co">#&gt;   trees min_n learn_rate `agent hash` `company hash` .metric .estimator  mean     n std_err .config              </span></span>
<span id="cb65-4"><a href=""></a><span class="co">#&gt;   &lt;int&gt; &lt;int&gt;      &lt;dbl&gt;        &lt;int&gt;          &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                </span></span>
<span id="cb65-5"><a href=""></a><span class="co">#&gt; 1  1347     5     0.0655           66             26 mae     standard    9.64    10   0.173 Preprocessor34_Model1</span></span>
<span id="cb65-6"><a href=""></a><span class="co">#&gt; 2   980     8     0.0429           17            135 mae     standard    9.76    10   0.164 Preprocessor25_Model1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">

</div>
</section>
<section id="racing-results-1" class="slide level2">
<h2>Racing Results <img data-src="hexes/finetune.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>Only 171 models were fit (out of 500).</p>
<p><code>select_best()</code> never considers candidate models that did not get to the end of the race.</p>
<p>There is a helper function to see how candidate models were removed from consideration.</p>
</div><div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href=""></a><span class="fu">plot_race</span>(lgbm_race_res) <span class="sc">+</span> </span>
<span id="cb66-2"><a href=""></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">pretty_breaks</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="part-II_files/figure-revealjs/plot-race-1.svg" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
<aside class="notes">
<p>X-axis: Analysis Stage</p>
<ul>
<li>Each number (1–10) represents a stage in the racing process — roughly corresponding to how many resamples (e.g., CV folds) have been used to evaluate each model.</li>
</ul>
<p>Y-axis: mae</p>
<ul>
<li>Mean Absolute Error (MAE) — a lower value is better.</li>
<li>It shows the current estimated performance of each candidate model at each stage.</li>
</ul>
<p>Colored lines:</p>
<ul>
<li>Each line represents a single candidate model (e.g., a unique combo of hyperparameters and preprocessing).</li>
<li>The lines trace each model’s cumulative average MAE as more resamples are completed.</li>
</ul>
<p>Interpretation</p>
<ol type="1">
<li>Early stages (left side):</li>
</ol>
<ul>
<li>All models are present.</li>
<li>MAE estimates are noisy (due to fewer resamples).</li>
<li>You see a wide spread: some models are at ~10 MAE, others are 20–50+.</li>
</ul>
<ol start="2" type="1">
<li>Middle stages (~Stage 4–5):</li>
</ol>
<ul>
<li>Poor models (high MAE) stop updating → they’ve been discarded by racing.</li>
<li>Only promising models remain (lines flatten out).</li>
</ul>
<ol start="3" type="1">
<li>Later stages (~Stage 6–10):</li>
</ol>
<ul>
<li>Only top-performing models are still being evaluated.</li>
<li>Their MAE estimates stabilize.</li>
<li>Most high-MAE lines disappear (they were dropped earlier).</li>
</ul>
<p>So we see that:</p>
<ul>
<li>Racing is working as intended:</li>
<li>Poor models are eliminated early (saves time).</li>
<li>Good models are evaluated fully.</li>
<li>The best model is likely the one with the flattest line near the bottom (lowest MAE).</li>
<li>Most models were clearly worse (many start &gt; MAE 20 or 30) and got dropped before stage 6.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="footer">

</div>
</section>
<section id="your-turn-7" class="slide level2" data-transition="slide-in">
<h2>Your turn</h2>
<ul>
<li><em>Run <code>tune_race_anova()</code> with a different seed.</em></li>
<li><em>Did you get the same or similar results?</em></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="racing-repeat" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">−</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
<div class="footer">

</div>
</section>
<section id="your-turn-8" class="slide level2" data-transition="slide-in">
<h2>Your turn</h2>
<ul>
<li><p><em>Now repeat the process using <code>tune_race_anova()</code>, but this time focus on performance metric <code>rsq</code> (use <code>set.seed(9)</code> as before).</em></p></li>
<li><p><em>What can you conclude when you compare results from <code>mae</code> and <code>rsq</code>?</em></p></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="racing-repeat" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">−</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">15</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
<div class="footer">

</div>
</section></section>
<section id="open-worksheet-4" class="title-slide slide level1 center">
<h1>Open Worksheet 4 📄</h1>
<div class="footer">

</div>
</section>

<section>
<section id="iterative-search-1" class="title-slide slide level1 center">
<h1>Iterative Search</h1>
<div class="footer">

</div>
</section>
<section id="previously---setup-3" class="slide level2">
<h2>Previously - Setup</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href=""></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb67-2"><a href=""></a><span class="fu">library</span>(textrecipes)</span>
<span id="cb67-3"><a href=""></a><span class="fu">library</span>(bonsai)</span>
<span id="cb67-4"><a href=""></a></span>
<span id="cb67-5"><a href=""></a><span class="co"># extra settings: </span></span>
<span id="cb67-6"><a href=""></a><span class="fu">tidymodels_prefer</span>()</span>
<span id="cb67-7"><a href=""></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())</span>
<span id="cb67-8"><a href=""></a><span class="fu">options</span>(</span>
<span id="cb67-9"><a href=""></a>  <span class="at">pillar.advice =</span> <span class="cn">FALSE</span>, </span>
<span id="cb67-10"><a href=""></a>  <span class="at">pillar.min_title_chars =</span> <span class="cn">Inf</span></span>
<span id="cb67-11"><a href=""></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href=""></a><span class="fu">data</span>(hotel_rates)</span>
<span id="cb68-2"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">295</span>)</span>
<span id="cb68-3"><a href=""></a>hotel_rates <span class="ot">&lt;-</span> </span>
<span id="cb68-4"><a href=""></a>  hotel_rates <span class="sc">%&gt;%</span> </span>
<span id="cb68-5"><a href=""></a>  <span class="fu">sample_n</span>(<span class="dv">5000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb68-6"><a href=""></a>  <span class="fu">arrange</span>(arrival_date) <span class="sc">%&gt;%</span> </span>
<span id="cb68-7"><a href=""></a>  <span class="fu">select</span>(<span class="sc">-</span>arrival_date) <span class="sc">%&gt;%</span>  </span>
<span id="cb68-8"><a href=""></a>  <span class="fu">mutate</span>(</span>
<span id="cb68-9"><a href=""></a>    <span class="at">company =</span> <span class="fu">factor</span>(<span class="fu">as.character</span>(company)),</span>
<span id="cb68-10"><a href=""></a>    <span class="at">country =</span> <span class="fu">factor</span>(<span class="fu">as.character</span>(country)),</span>
<span id="cb68-11"><a href=""></a>    <span class="at">agent =</span> <span class="fu">factor</span>(<span class="fu">as.character</span>(agent))</span>
<span id="cb68-12"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div></div>
<div class="footer">

</div>
</section>
<section id="previously---data-usage-3" class="slide level2">
<h2>Previously - Data Usage</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">4028</span>)</span>
<span id="cb69-2"><a href=""></a>hotel_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(hotel_rates, <span class="at">strata =</span> avg_price_per_room)</span>
<span id="cb69-3"><a href=""></a></span>
<span id="cb69-4"><a href=""></a>hotel_train <span class="ot">&lt;-</span> <span class="fu">training</span>(hotel_split)</span>
<span id="cb69-5"><a href=""></a>hotel_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(hotel_split)</span>
<span id="cb69-6"><a href=""></a></span>
<span id="cb69-7"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">472</span>)</span>
<span id="cb69-8"><a href=""></a>hotel_rs <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(hotel_train, <span class="at">strata =</span> avg_price_per_room)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">

</div>
</section>
<section id="our-boosting-model" class="slide level2">
<h2>Our Boosting Model</h2>
<p>We used feature hashing to generate a smaller set of indicator columns to deal with the large number of levels for the agent and country predictors.</p>
<p><br></p>
<p>Tree-based models (and a few others) don’t require indicators for categorical predictors. They can split on these variables as-is.</p>
<p><br></p>
<p>We’ll keep all categorical predictors as factors and focus on optimizing additional boosting parameters.</p>
<div class="footer">

</div>
</section>
<section id="our-boosting-model-1" class="slide level2">
<h2>Our Boosting Model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href=""></a>lgbm_spec <span class="ot">&lt;-</span> </span>
<span id="cb70-2"><a href=""></a>  <span class="fu">boost_tree</span>(<span class="at">trees =</span> <span class="dv">1000</span>, <span class="at">learn_rate =</span> <span class="fu">tune</span>(), <span class="at">min_n =</span> <span class="fu">tune</span>(), </span>
<span id="cb70-3"><a href=""></a>             <span class="at">tree_depth =</span> <span class="fu">tune</span>(), <span class="at">loss_reduction =</span> <span class="fu">tune</span>(), </span>
<span id="cb70-4"><a href=""></a>             <span class="at">stop_iter =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb70-5"><a href=""></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb70-6"><a href=""></a>  <span class="fu">set_engine</span>(<span class="st">"lightgbm"</span>, <span class="at">num_threads =</span> <span class="dv">1</span>)</span>
<span id="cb70-7"><a href=""></a></span>
<span id="cb70-8"><a href=""></a>lgbm_wflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>(avg_price_per_room <span class="sc">~</span> ., lgbm_spec)</span>
<span id="cb70-9"><a href=""></a></span>
<span id="cb70-10"><a href=""></a>lgbm_param <span class="ot">&lt;-</span> </span>
<span id="cb70-11"><a href=""></a>  lgbm_wflow <span class="sc">%&gt;%</span></span>
<span id="cb70-12"><a href=""></a>    <span class="fu">extract_parameter_set_dials</span>() <span class="sc">%&gt;%</span></span>
<span id="cb70-13"><a href=""></a>    <span class="fu">update</span>(<span class="at">learn_rate =</span> <span class="fu">learn_rate</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="sc">-</span><span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">

</div>
</section>
<section id="iterative-search-2" class="slide level2">
<h2>Iterative Search</h2>
<p>Instead of pre-defining a grid of candidate points, we can model our current results to predict what the next candidate point should be.</p>
<p><br></p>
<p>Suppose that we are only tuning the learning rate in our boosted tree.</p>
<p><br></p>
<p>We could do something like:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href=""></a>mae_pred <span class="ot">&lt;-</span> <span class="fu">lm</span>(mae <span class="sc">~</span> learn_rate, <span class="at">data =</span> resample_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>and use this to predict and rank new learning rate candidates.</p>
<div class="footer">

</div>
</section>
<section id="iterative-search-3" class="slide level2">
<h2>Iterative Search</h2>
<p>A linear model probably isn’t the best choice though (more in a minute).</p>
<p>To illustrate the process, we resampled a large grid of learning rate values for our data to show what the relationship is between MAE and learning rate.</p>
<p>Now suppose that we used a grid of three points in the parameter range for learning rate…</p>
<div class="footer">

</div>
</section>
<section id="a-large-grid" class="slide level2">
<h2>A Large Grid</h2>

<img data-src="part-II_files/figure-revealjs/grid-large-1.svg" class="quarto-figure quarto-figure-center r-stretch" style="width:50.0%"><div class="footer">

</div>
</section>
<section id="a-three-point-grid" class="slide level2">
<h2>A Three Point Grid</h2>

<img data-src="part-II_files/figure-revealjs/grid-large-sampled-1.svg" class="quarto-figure quarto-figure-center r-stretch" style="width:50.0%"><div class="footer">

</div>
</section>
<section id="gaussian-processes-and-optimization" class="slide level2 annotation">
<h2>Gaussian Processes and Optimization</h2>
<p>We can make a “meta-model” with a small set of historical performance results.</p>
<p><a href="https://gaussianprocess.org/gpml/">Gaussian Processes</a> (GP) models are a good choice to model performance.</p>
<ul>
<li>It is a Bayesian model so we are using <strong>Bayesian Optimization (BO)</strong>.</li>
<li>For regression, we can assume that our data are multivariate normal.</li>
<li>We also define a <em>covariance</em> function for the variance relationship between data points. A common one is:</li>
</ul>
<p><span class="math display">\[\operatorname{cov}(\boldsymbol{x}_i, \boldsymbol{x}_j) = \exp\left(-\frac{1}{2}|\boldsymbol{x}_i - \boldsymbol{x}_j|^2\right) + \sigma^2_{ij}\]</span></p>
<aside class="notes">
<p>GPs are good because</p>
<ul>
<li>they are flexible regression models (in the sense that splines are flexible).</li>
<li>we need to get mean and variance predictions (and they are Bayesian)</li>
<li>their variability is based on spatial distances.</li>
</ul>
<p>Some people use random forests (with conformal variance estimates) or other methods but GPs are most popular.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="footer">

</div>
</section>
<section id="predicting-candidates" class="slide level2">
<h2>Predicting Candidates</h2>
<p>The GP model can take candidate tuning parameter combinations as inputs and make predictions for performance (e.g.&nbsp;MAE)</p>
<ul>
<li>The <em>mean</em> performance</li>
<li>The <em>variance</em> of performance</li>
</ul>
<p>The variance is mostly driven by spatial variability (the previous equation).</p>
<p>The predicted variance is zero at locations of actual data points and becomes very high when far away from any observed data.</p>
<div class="footer">

</div>
</section>
<section id="your-turn-9" class="slide level2" data-transition="slide-in">
<h2>Your turn</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><em>Your GP makes predictions on two new candidate tuning parameters.</em></p>
<p><em>We want to minimize MAE.</em></p>
<p><em>Which should we choose?</em></p>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="part-II_files/figure-revealjs/two-candidates-1.svg" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="mean-var-trade" data-update-every="1" tabindex="0" style="bottom:0;left:0;">
<div class="countdown-controls"><button class="countdown-bump-down">−</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">03</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
<div class="footer">

</div>
</section>
<section id="gp-fit-ribbon-is-mean---1sd" class="slide level2">
<h2>GP Fit (ribbon is mean +/- 1SD)</h2>

<img data-src="part-II_files/figure-revealjs/gp-iter-0-1.svg" class="quarto-figure quarto-figure-center r-stretch" style="width:50.0%"><div class="footer">

</div>
</section>
<section id="choosing-new-candidates" class="slide level2">
<h2>Choosing New Candidates</h2>
<p>This isn’t a very good fit but we can still use it.</p>
<p>How can we use the outputs to choose the next point to measure?</p>
<p><br></p>
<p><a href="https://ekamperi.github.io/machine%20learning/2021/06/11/acquisition-functions.html"><em>Acquisition functions</em></a> take the predicted mean and variance and use them to balance:</p>
<ul>
<li><em>exploration</em>: new candidates should explore new areas.</li>
<li><em>exploitation</em>: new candidates must stay near existing values.</li>
</ul>
<p>Exploration focuses on the variance, exploitation is about the mean.</p>
<div class="footer">

</div>
</section>
<section id="acquisition-functions" class="slide level2">
<h2>Acquisition Functions</h2>
<p>We’ll use an acquisition function to select a new candidate.</p>
<p>The most popular method appears to be <em>expected improvement</em> (<a href="https://arxiv.org/pdf/1911.12809.pdf">EI</a>) above the current best results.</p>
<ul>
<li>Zero at existing data points.</li>
<li>The <em>expected</em> improvement is integrated over all possible improvement (“expected” in the probability sense).</li>
</ul>
<p>We would probably pick the point with the largest EI as the next point.</p>
<p>(There are other functions beyond EI.)</p>
<div class="footer">

</div>
</section>
<section id="expected-improvement" class="slide level2">
<h2>Expected Improvement</h2>

<img data-src="part-II_files/figure-revealjs/gp-iter-0-ei-1.svg" class="quarto-figure quarto-figure-center r-stretch" style="width:50.0%"><div class="footer">

</div>
</section>
<section id="iteration" class="slide level2">
<h2>Iteration</h2>
<p>Once we pick the candidate point, we measure performance for it (e.g.&nbsp;resampling).</p>
<p><br></p>
<p>Another GP is fit, EI is recomputed, and so on.</p>
<p><br></p>
<p>We stop when we have completed the allowed number of iterations <em>or</em> if we don’t see any improvement after a pre-set number of attempts.</p>
<div class="footer">

</div>
</section>
<section id="gp-fit-with-four-points" class="slide level2">
<h2>GP Fit with four points</h2>

<img data-src="part-II_files/figure-revealjs/gp-iter-1-1.svg" class="quarto-figure quarto-figure-center r-stretch" style="width:50.0%"><div class="footer">

</div>
</section>
<section id="expected-improvement-1" class="slide level2">
<h2>Expected Improvement</h2>

<img data-src="part-II_files/figure-revealjs/gp-iter-1-ei-1.svg" class="quarto-figure quarto-figure-center r-stretch" style="width:50.0%"><div class="footer">

</div>
</section>
<section id="gp-evolution" class="slide level2">
<h2>GP Evolution</h2>

<img data-src="animations/anime_gp.gif" class="quarto-figure quarto-figure-center r-stretch" style="width:50.0%"><div class="footer">

</div>
</section>
<section id="expected-improvement-evolution" class="slide level2">
<h2>Expected Improvement Evolution</h2>

<img data-src="animations/anime_improvement.gif" class="quarto-figure quarto-figure-center r-stretch" style="width:50.0%"><div class="footer">

</div>
</section>
<section id="bo-in-tidymodels" class="slide level2">
<h2>BO in tidymodels</h2>
<p>We’ll use a function called <code>tune_bayes()</code> that has very similar syntax to <code>tune_grid()</code>.</p>
<p><br></p>
<p>It has an additional <code>initial</code> argument for the initial set of performance estimates and parameter combinations for the GP model.</p>
<div class="footer">

</div>
</section>
<section id="initial-grid-points" class="slide level2">
<h2>Initial grid points</h2>
<p><code>initial</code> can be the results of another <code>tune_*()</code> function or an integer (in which case <code>tune_grid()</code> is used under to hood to make such an initial set of results).</p>
<ul>
<li><p>We’ll run the optimization more than once, so let’s make an initial grid of results to serve as the substrate for the BO.</p></li>
<li><p>I suggest at least the number of tuning parameters plus two as the initial grid for BO.</p></li>
</ul>
<div class="footer">

</div>
</section>
<section id="an-initial-grid" class="slide level2">
<h2>An Initial Grid</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href=""></a>reg_metrics <span class="ot">&lt;-</span> <span class="fu">metric_set</span>(mae, rsq)</span>
<span id="cb72-2"><a href=""></a></span>
<span id="cb72-3"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">12</span>)</span>
<span id="cb72-4"><a href=""></a>init_res <span class="ot">&lt;-</span></span>
<span id="cb72-5"><a href=""></a>  lgbm_wflow <span class="sc">%&gt;%</span></span>
<span id="cb72-6"><a href=""></a>  <span class="fu">tune_grid</span>(</span>
<span id="cb72-7"><a href=""></a>    <span class="at">resamples =</span> hotel_rs,</span>
<span id="cb72-8"><a href=""></a>    <span class="at">grid =</span> <span class="fu">nrow</span>(lgbm_param) <span class="sc">+</span> <span class="dv">2</span>,</span>
<span id="cb72-9"><a href=""></a>    <span class="at">param_info =</span> lgbm_param,</span>
<span id="cb72-10"><a href=""></a>    <span class="at">metrics =</span> reg_metrics</span>
<span id="cb72-11"><a href=""></a>  )</span>
<span id="cb72-12"><a href=""></a></span>
<span id="cb72-13"><a href=""></a><span class="fu">show_best</span>(init_res, <span class="at">metric =</span> <span class="st">"mae"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>.metric, <span class="sc">-</span>.estimator)</span>
<span id="cb72-14"><a href=""></a><span class="co">#&gt; # A tibble: 5 × 9</span></span>
<span id="cb72-15"><a href=""></a><span class="co">#&gt;   min_n tree_depth learn_rate loss_reduction stop_iter  mean     n std_err .config             </span></span>
<span id="cb72-16"><a href=""></a><span class="co">#&gt;   &lt;int&gt;      &lt;int&gt;      &lt;dbl&gt;          &lt;dbl&gt;     &lt;int&gt; &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span id="cb72-17"><a href=""></a><span class="co">#&gt; 1    33         12   0.0215         8.25e- 9         5  10.1    10   0.182 Preprocessor1_Model6</span></span>
<span id="cb72-18"><a href=""></a><span class="co">#&gt; 2    14         10   0.1            3.16e+ 1         8  10.2    10   0.192 Preprocessor1_Model3</span></span>
<span id="cb72-19"><a href=""></a><span class="co">#&gt; 3     8          3   0.00464        1   e-10        11  14.4    10   0.305 Preprocessor1_Model2</span></span>
<span id="cb72-20"><a href=""></a><span class="co">#&gt; 4    40          1   0.001          4.64e- 3        14  36.1    10   0.408 Preprocessor1_Model7</span></span>
<span id="cb72-21"><a href=""></a><span class="co">#&gt; 5    27         15   0.000215       6.81e- 7        20  44.5    10   0.371 Preprocessor1_Model5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">

</div>
</section>
<section id="bo-using-tidymodels" class="slide level2">
<h2>BO using tidymodels</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb73" data-code-line-numbers="1|6,8-11|"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href=""></a>ctrl_bo <span class="ot">&lt;-</span> <span class="fu">control_bayes</span>(<span class="at">verbose_iter =</span> <span class="cn">TRUE</span>) <span class="co"># &lt;- for demonstration</span></span>
<span id="cb73-2"><a href=""></a></span>
<span id="cb73-3"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">15</span>)</span>
<span id="cb73-4"><a href=""></a>lgbm_bayes_res <span class="ot">&lt;-</span></span>
<span id="cb73-5"><a href=""></a>  lgbm_wflow <span class="sc">%&gt;%</span></span>
<span id="cb73-6"><a href=""></a>  <span class="fu">tune_bayes</span>(</span>
<span id="cb73-7"><a href=""></a>    <span class="at">resamples =</span> hotel_rs,</span>
<span id="cb73-8"><a href=""></a>    <span class="at">initial =</span> init_res,     <span class="co"># &lt;- initial results</span></span>
<span id="cb73-9"><a href=""></a>    <span class="at">iter =</span> <span class="dv">20</span>,</span>
<span id="cb73-10"><a href=""></a>    <span class="at">param_info =</span> lgbm_param,</span>
<span id="cb73-11"><a href=""></a>    <span class="at">control =</span> ctrl_bo,</span>
<span id="cb73-12"><a href=""></a>    <span class="at">metrics =</span> reg_metrics</span>
<span id="cb73-13"><a href=""></a>  )</span>
<span id="cb73-14"><a href=""></a><span class="co">#&gt; Optimizing mae using the expected improvement</span></span>
<span id="cb73-15"><a href=""></a><span class="co">#&gt; </span></span>
<span id="cb73-16"><a href=""></a><span class="co">#&gt; ── Iteration 1 ───────────────────────────────────────────────────────</span></span>
<span id="cb73-17"><a href=""></a><span class="co">#&gt; </span></span>
<span id="cb73-18"><a href=""></a><span class="co">#&gt; i Current best:      mae=10.05 (@iter 0)</span></span>
<span id="cb73-19"><a href=""></a><span class="co">#&gt; i Gaussian process model</span></span>
<span id="cb73-20"><a href=""></a><span class="co">#&gt; ✓ Gaussian process model</span></span>
<span id="cb73-21"><a href=""></a><span class="co">#&gt; i Generating 5000 candidates</span></span>
<span id="cb73-22"><a href=""></a><span class="co">#&gt; i Predicted candidates</span></span>
<span id="cb73-23"><a href=""></a><span class="co">#&gt; i min_n=7, tree_depth=13, learn_rate=0.0802, loss_reduction=1.13e-10, stop_iter=17</span></span>
<span id="cb73-24"><a href=""></a><span class="co">#&gt; i Estimating performance</span></span>
<span id="cb73-25"><a href=""></a><span class="co">#&gt; ✓ Estimating performance</span></span>
<span id="cb73-26"><a href=""></a><span class="co">#&gt; ♥ Newest results:    mae=9.599 (+/-0.135)</span></span>
<span id="cb73-27"><a href=""></a><span class="co">#&gt; </span></span>
<span id="cb73-28"><a href=""></a><span class="co">#&gt; ── Iteration 2 ───────────────────────────────────────────────────────</span></span>
<span id="cb73-29"><a href=""></a><span class="co">#&gt; </span></span>
<span id="cb73-30"><a href=""></a><span class="co">#&gt; i Current best:      mae=9.599 (@iter 1)</span></span>
<span id="cb73-31"><a href=""></a><span class="co">#&gt; i Gaussian process model</span></span>
<span id="cb73-32"><a href=""></a><span class="co">#&gt; ✓ Gaussian process model</span></span>
<span id="cb73-33"><a href=""></a><span class="co">#&gt; i Generating 5000 candidates</span></span>
<span id="cb73-34"><a href=""></a><span class="co">#&gt; i Predicted candidates</span></span>
<span id="cb73-35"><a href=""></a><span class="co">#&gt; i min_n=2, tree_depth=7, learn_rate=0.0255, loss_reduction=1.22e-07, stop_iter=14</span></span>
<span id="cb73-36"><a href=""></a><span class="co">#&gt; i Estimating performance</span></span>
<span id="cb73-37"><a href=""></a><span class="co">#&gt; ✓ Estimating performance</span></span>
<span id="cb73-38"><a href=""></a><span class="co">#&gt; ⓧ Newest results:    mae=9.895 (+/-0.183)</span></span>
<span id="cb73-39"><a href=""></a><span class="co">#&gt; </span></span>
<span id="cb73-40"><a href=""></a><span class="co">#&gt; ── Iteration 3 ───────────────────────────────────────────────────────</span></span>
<span id="cb73-41"><a href=""></a><span class="co">#&gt; </span></span>
<span id="cb73-42"><a href=""></a><span class="co">#&gt; i Current best:      mae=9.599 (@iter 1)</span></span>
<span id="cb73-43"><a href=""></a><span class="co">#&gt; i Gaussian process model</span></span>
<span id="cb73-44"><a href=""></a><span class="co">#&gt; ✓ Gaussian process model</span></span>
<span id="cb73-45"><a href=""></a><span class="co">#&gt; i Generating 5000 candidates</span></span>
<span id="cb73-46"><a href=""></a><span class="co">#&gt; i Predicted candidates</span></span>
<span id="cb73-47"><a href=""></a><span class="co">#&gt; i min_n=28, tree_depth=5, learn_rate=0.0507, loss_reduction=1.91e-09, stop_iter=16</span></span>
<span id="cb73-48"><a href=""></a><span class="co">#&gt; i Estimating performance</span></span>
<span id="cb73-49"><a href=""></a><span class="co">#&gt; ✓ Estimating performance</span></span>
<span id="cb73-50"><a href=""></a><span class="co">#&gt; ⓧ Newest results:    mae=9.975 (+/-0.186)</span></span>
<span id="cb73-51"><a href=""></a><span class="co">#&gt; </span></span>
<span id="cb73-52"><a href=""></a><span class="co">#&gt; ── Iteration 4 ───────────────────────────────────────────────────────</span></span>
<span id="cb73-53"><a href=""></a><span class="co">#&gt; </span></span>
<span id="cb73-54"><a href=""></a><span class="co">#&gt; i Current best:      mae=9.599 (@iter 1)</span></span>
<span id="cb73-55"><a href=""></a><span class="co">#&gt; i Gaussian process model</span></span>
<span id="cb73-56"><a href=""></a><span class="co">#&gt; ✓ Gaussian process model</span></span>
<span id="cb73-57"><a href=""></a><span class="co">#&gt; i Generating 5000 candidates</span></span>
<span id="cb73-58"><a href=""></a><span class="co">#&gt; i Predicted candidates</span></span>
<span id="cb73-59"><a href=""></a><span class="co">#&gt; i min_n=3, tree_depth=11, learn_rate=0.0117, loss_reduction=0.00846, stop_iter=18</span></span>
<span id="cb73-60"><a href=""></a><span class="co">#&gt; i Estimating performance</span></span>
<span id="cb73-61"><a href=""></a><span class="co">#&gt; ✓ Estimating performance</span></span>
<span id="cb73-62"><a href=""></a><span class="co">#&gt; ⓧ Newest results:    mae=10.25 (+/-0.194)</span></span>
<span id="cb73-63"><a href=""></a><span class="co">#&gt; </span></span>
<span id="cb73-64"><a href=""></a><span class="co">#&gt; ── Iteration 5 ───────────────────────────────────────────────────────</span></span>
<span id="cb73-65"><a href=""></a><span class="co">#&gt; </span></span>
<span id="cb73-66"><a href=""></a><span class="co">#&gt; i Current best:      mae=9.599 (@iter 1)</span></span>
<span id="cb73-67"><a href=""></a><span class="co">#&gt; i Gaussian process model</span></span>
<span id="cb73-68"><a href=""></a><span class="co">#&gt; ✓ Gaussian process model</span></span>
<span id="cb73-69"><a href=""></a><span class="co">#&gt; i Generating 5000 candidates</span></span>
<span id="cb73-70"><a href=""></a><span class="co">#&gt; i Predicted candidates</span></span>
<span id="cb73-71"><a href=""></a><span class="co">#&gt; i min_n=34, tree_depth=1, learn_rate=0.0695, loss_reduction=0.00028, stop_iter=10</span></span>
<span id="cb73-72"><a href=""></a><span class="co">#&gt; i Estimating performance</span></span>
<span id="cb73-73"><a href=""></a><span class="co">#&gt; ✓ Estimating performance</span></span>
<span id="cb73-74"><a href=""></a><span class="co">#&gt; ⓧ Newest results:    mae=15.57 (+/-0.254)</span></span>
<span id="cb73-75"><a href=""></a><span class="co">#&gt; </span></span>
<span id="cb73-76"><a href=""></a><span class="co">#&gt; ── Iteration 6 ───────────────────────────────────────────────────────</span></span>
<span id="cb73-77"><a href=""></a><span class="co">#&gt; </span></span>
<span id="cb73-78"><a href=""></a><span class="co">#&gt; i Current best:      mae=9.599 (@iter 1)</span></span>
<span id="cb73-79"><a href=""></a><span class="co">#&gt; i Gaussian process model</span></span>
<span id="cb73-80"><a href=""></a><span class="co">#&gt; ✓ Gaussian process model</span></span>
<span id="cb73-81"><a href=""></a><span class="co">#&gt; i Generating 5000 candidates</span></span>
<span id="cb73-82"><a href=""></a><span class="co">#&gt; i Predicted candidates</span></span>
<span id="cb73-83"><a href=""></a><span class="co">#&gt; i min_n=18, tree_depth=13, learn_rate=0.0229, loss_reduction=0.181, stop_iter=19</span></span>
<span id="cb73-84"><a href=""></a><span class="co">#&gt; i Estimating performance</span></span>
<span id="cb73-85"><a href=""></a><span class="co">#&gt; ✓ Estimating performance</span></span>
<span id="cb73-86"><a href=""></a><span class="co">#&gt; ⓧ Newest results:    mae=9.882 (+/-0.166)</span></span>
<span id="cb73-87"><a href=""></a><span class="co">#&gt; </span></span>
<span id="cb73-88"><a href=""></a><span class="co">#&gt; ── Iteration 7 ───────────────────────────────────────────────────────</span></span>
<span id="cb73-89"><a href=""></a><span class="co">#&gt; </span></span>
<span id="cb73-90"><a href=""></a><span class="co">#&gt; i Current best:      mae=9.599 (@iter 1)</span></span>
<span id="cb73-91"><a href=""></a><span class="co">#&gt; i Gaussian process model</span></span>
<span id="cb73-92"><a href=""></a><span class="co">#&gt; ✓ Gaussian process model</span></span>
<span id="cb73-93"><a href=""></a><span class="co">#&gt; i Generating 5000 candidates</span></span>
<span id="cb73-94"><a href=""></a><span class="co">#&gt; i Predicted candidates</span></span>
<span id="cb73-95"><a href=""></a><span class="co">#&gt; i min_n=39, tree_depth=11, learn_rate=0.0485, loss_reduction=0.000906, stop_iter=19</span></span>
<span id="cb73-96"><a href=""></a><span class="co">#&gt; i Estimating performance</span></span>
<span id="cb73-97"><a href=""></a><span class="co">#&gt; ✓ Estimating performance</span></span>
<span id="cb73-98"><a href=""></a><span class="co">#&gt; ⓧ Newest results:    mae=9.883 (+/-0.169)</span></span>
<span id="cb73-99"><a href=""></a><span class="co">#&gt; </span></span>
<span id="cb73-100"><a href=""></a><span class="co">#&gt; ── Iteration 8 ───────────────────────────────────────────────────────</span></span>
<span id="cb73-101"><a href=""></a><span class="co">#&gt; </span></span>
<span id="cb73-102"><a href=""></a><span class="co">#&gt; i Current best:      mae=9.599 (@iter 1)</span></span>
<span id="cb73-103"><a href=""></a><span class="co">#&gt; i Gaussian process model</span></span>
<span id="cb73-104"><a href=""></a><span class="co">#&gt; ✓ Gaussian process model</span></span>
<span id="cb73-105"><a href=""></a><span class="co">#&gt; i Generating 5000 candidates</span></span>
<span id="cb73-106"><a href=""></a><span class="co">#&gt; i Predicted candidates</span></span>
<span id="cb73-107"><a href=""></a><span class="co">#&gt; i min_n=27, tree_depth=11, learn_rate=0.0396, loss_reduction=1.54e-10, stop_iter=6</span></span>
<span id="cb73-108"><a href=""></a><span class="co">#&gt; i Estimating performance</span></span>
<span id="cb73-109"><a href=""></a><span class="co">#&gt; ✓ Estimating performance</span></span>
<span id="cb73-110"><a href=""></a><span class="co">#&gt; ⓧ Newest results:    mae=9.811 (+/-0.195)</span></span>
<span id="cb73-111"><a href=""></a><span class="co">#&gt; </span></span>
<span id="cb73-112"><a href=""></a><span class="co">#&gt; ── Iteration 9 ───────────────────────────────────────────────────────</span></span>
<span id="cb73-113"><a href=""></a><span class="co">#&gt; </span></span>
<span id="cb73-114"><a href=""></a><span class="co">#&gt; i Current best:      mae=9.599 (@iter 1)</span></span>
<span id="cb73-115"><a href=""></a><span class="co">#&gt; i Gaussian process model</span></span>
<span id="cb73-116"><a href=""></a><span class="co">#&gt; ✓ Gaussian process model</span></span>
<span id="cb73-117"><a href=""></a><span class="co">#&gt; i Generating 5000 candidates</span></span>
<span id="cb73-118"><a href=""></a><span class="co">#&gt; i Predicted candidates</span></span>
<span id="cb73-119"><a href=""></a><span class="co">#&gt; i min_n=39, tree_depth=5, learn_rate=0.0131, loss_reduction=6.45e-05, stop_iter=16</span></span>
<span id="cb73-120"><a href=""></a><span class="co">#&gt; i Estimating performance</span></span>
<span id="cb73-121"><a href=""></a><span class="co">#&gt; ✓ Estimating performance</span></span>
<span id="cb73-122"><a href=""></a><span class="co">#&gt; ⓧ Newest results:    mae=10.55 (+/-0.152)</span></span>
<span id="cb73-123"><a href=""></a><span class="co">#&gt; </span></span>
<span id="cb73-124"><a href=""></a><span class="co">#&gt; ── Iteration 10 ──────────────────────────────────────────────────────</span></span>
<span id="cb73-125"><a href=""></a><span class="co">#&gt; </span></span>
<span id="cb73-126"><a href=""></a><span class="co">#&gt; i Current best:      mae=9.599 (@iter 1)</span></span>
<span id="cb73-127"><a href=""></a><span class="co">#&gt; i Gaussian process model</span></span>
<span id="cb73-128"><a href=""></a><span class="co">#&gt; ✓ Gaussian process model</span></span>
<span id="cb73-129"><a href=""></a><span class="co">#&gt; i Generating 5000 candidates</span></span>
<span id="cb73-130"><a href=""></a><span class="co">#&gt; i Predicted candidates</span></span>
<span id="cb73-131"><a href=""></a><span class="co">#&gt; i min_n=15, tree_depth=15, learn_rate=0.00677, loss_reduction=5.01e-06, stop_iter=19</span></span>
<span id="cb73-132"><a href=""></a><span class="co">#&gt; i Estimating performance</span></span>
<span id="cb73-133"><a href=""></a><span class="co">#&gt; ✓ Estimating performance</span></span>
<span id="cb73-134"><a href=""></a><span class="co">#&gt; ⓧ Newest results:    mae=10.73 (+/-0.214)</span></span>
<span id="cb73-135"><a href=""></a><span class="co">#&gt; </span></span>
<span id="cb73-136"><a href=""></a><span class="co">#&gt; ── Iteration 11 ──────────────────────────────────────────────────────</span></span>
<span id="cb73-137"><a href=""></a><span class="co">#&gt; </span></span>
<span id="cb73-138"><a href=""></a><span class="co">#&gt; i Current best:      mae=9.599 (@iter 1)</span></span>
<span id="cb73-139"><a href=""></a><span class="co">#&gt; i Gaussian process model</span></span>
<span id="cb73-140"><a href=""></a><span class="co">#&gt; ✓ Gaussian process model</span></span>
<span id="cb73-141"><a href=""></a><span class="co">#&gt; i Generating 5000 candidates</span></span>
<span id="cb73-142"><a href=""></a><span class="co">#&gt; i Predicted candidates</span></span>
<span id="cb73-143"><a href=""></a><span class="co">#&gt; i min_n=15, tree_depth=15, learn_rate=0.0929, loss_reduction=2.08, stop_iter=18</span></span>
<span id="cb73-144"><a href=""></a><span class="co">#&gt; i Estimating performance</span></span>
<span id="cb73-145"><a href=""></a><span class="co">#&gt; ✓ Estimating performance</span></span>
<span id="cb73-146"><a href=""></a><span class="co">#&gt; ⓧ Newest results:    mae=9.82 (+/-0.141)</span></span>
<span id="cb73-147"><a href=""></a><span class="co">#&gt; ! No improvement for 10 iterations; returning current results.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">

</div>
</section>
<section id="best-results" class="slide level2">
<h2>Best results</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href=""></a><span class="fu">show_best</span>(lgbm_bayes_res, <span class="at">metric =</span> <span class="st">"mae"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>.metric, <span class="sc">-</span>.estimator)</span>
<span id="cb74-2"><a href=""></a><span class="co">#&gt; # A tibble: 5 × 10</span></span>
<span id="cb74-3"><a href=""></a><span class="co">#&gt;   min_n tree_depth learn_rate loss_reduction stop_iter  mean     n std_err .config .iter</span></span>
<span id="cb74-4"><a href=""></a><span class="co">#&gt;   &lt;int&gt;      &lt;int&gt;      &lt;dbl&gt;          &lt;dbl&gt;     &lt;int&gt; &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;int&gt;</span></span>
<span id="cb74-5"><a href=""></a><span class="co">#&gt; 1     7         13     0.0802       1.13e-10        17  9.60    10   0.135 Iter1       1</span></span>
<span id="cb74-6"><a href=""></a><span class="co">#&gt; 2    27         11     0.0396       1.54e-10         6  9.81    10   0.195 Iter8       8</span></span>
<span id="cb74-7"><a href=""></a><span class="co">#&gt; 3    15         15     0.0929       2.08e+ 0        18  9.82    10   0.141 Iter11     11</span></span>
<span id="cb74-8"><a href=""></a><span class="co">#&gt; 4    18         13     0.0229       1.81e- 1        19  9.88    10   0.166 Iter6       6</span></span>
<span id="cb74-9"><a href=""></a><span class="co">#&gt; 5    39         11     0.0485       9.06e- 4        19  9.88    10   0.169 Iter7       7</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">

</div>
</section>
<section id="plotting-bo-results" class="slide level2">
<h2>Plotting BO Results</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href=""></a><span class="fu">autoplot</span>(lgbm_bayes_res, <span class="at">metric =</span> <span class="st">"mae"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="part-II_files/figure-revealjs/autoplot-marginals-1.svg" class="quarto-figure quarto-figure-center r-stretch" style="width:50.0%"><div class="footer">

</div>
</section>
<section id="plotting-bo-results-1" class="slide level2">
<h2>Plotting BO Results</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href=""></a><span class="fu">autoplot</span>(lgbm_bayes_res, <span class="at">metric =</span> <span class="st">"mae"</span>, <span class="at">type =</span> <span class="st">"parameters"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="part-II_files/figure-revealjs/autoplot-param-1.svg" class="quarto-figure quarto-figure-center r-stretch" style="width:50.0%"><div class="footer">

</div>
</section>
<section id="plotting-bo-results-2" class="slide level2">
<h2>Plotting BO Results</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href=""></a><span class="fu">autoplot</span>(lgbm_bayes_res, <span class="at">metric =</span> <span class="st">"mae"</span>, <span class="at">type =</span> <span class="st">"performance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="part-II_files/figure-revealjs/autoplot-perf-1.svg" class="quarto-figure quarto-figure-center r-stretch" style="width:50.0%"><div class="footer">

</div>
</section>
<section id="enhance" class="slide level2">
<h2>ENHANCE</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href=""></a><span class="fu">autoplot</span>(lgbm_bayes_res, <span class="at">metric =</span> <span class="st">"mae"</span>, <span class="at">type =</span> <span class="st">"performance"</span>) <span class="sc">+</span></span>
<span id="cb78-2"><a href=""></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">14</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="part-II_files/figure-revealjs/autoplot-perf-zoomed-1.svg" class="quarto-figure quarto-figure-center r-stretch" style="width:50.0%"><div class="footer">

</div>
</section>
<section id="your-turn-10" class="slide level2" data-transition="slide-in">
<h2>Your turn</h2>
<p><em>Let’s try a different acquisition function: <code>conf_bound(kappa)</code>.</em></p>
<p><em>We’ll use the <code>objective</code> argument to set it.</em></p>
<p><em>Choose your own <code>kappa</code> value:</em></p>
<ul>
<li><em>Larger values will explore the space more.</em></li>
<li><em>“Large” values are usually less than one.</em></li>
</ul>
<p><strong>Bonus points</strong>: Before the optimization is done, press <code>&lt;esc&gt;</code> and see what happens.</p>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="conf-bound" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">−</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
<div class="footer">

</div>
</section>
<section id="notes" class="slide level2">
<h2>Notes</h2>
<ul>
<li><p>Stopping <code>tune_bayes()</code> will return the current results.</p></li>
<li><p>Parallel processing can still be used to more efficiently measure each candidate point.</p></li>
<li><p>There are <a href="https://github.com/topepo/Optimization-Methods-for-Tuning-Predictive-Models">a lot of other iterative methods</a> that you can use.</p></li>
<li><p>The finetune package also has functions for <a href="https://www.tmwr.org/iterative-search.html#simulated-annealing">simulated annealing</a> search.</p></li>
</ul>
<div class="footer">

</div>
</section>
<section id="finalizing-the-model" class="slide level2">
<h2>Finalizing the Model</h2>
<p>Let’s say that we’ve tried a lot of different models and we like our lightgbm model the most.</p>
<p>What do we do now?</p>
<ul>
<li>Finalize the workflow by choosing the values for the tuning parameters.</li>
<li>Fit the model on the entire training set.</li>
<li>Verify performance using the test set.</li>
<li>Document and publish the model(?)</li>
</ul>
<div class="footer">

</div>
</section>
<section id="locking-down-the-tuning-parameters" class="slide level2">
<h2>Locking Down the Tuning Parameters</h2>
<p>We can take the results of the Bayesian optimization and accept the best results:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href=""></a>best_param <span class="ot">&lt;-</span> <span class="fu">select_best</span>(lgbm_bayes_res, <span class="at">metric =</span> <span class="st">"mae"</span>)</span>
<span id="cb79-2"><a href=""></a>final_wflow <span class="ot">&lt;-</span> </span>
<span id="cb79-3"><a href=""></a>  lgbm_wflow <span class="sc">%&gt;%</span> </span>
<span id="cb79-4"><a href=""></a>  <span class="fu">finalize_workflow</span>(best_param)</span>
<span id="cb79-5"><a href=""></a>final_wflow</span>
<span id="cb79-6"><a href=""></a><span class="co">#&gt; ══ Workflow ══════════════════════════════════════════════════════════</span></span>
<span id="cb79-7"><a href=""></a><span class="co">#&gt; Preprocessor: Formula</span></span>
<span id="cb79-8"><a href=""></a><span class="co">#&gt; Model: boost_tree()</span></span>
<span id="cb79-9"><a href=""></a><span class="co">#&gt; </span></span>
<span id="cb79-10"><a href=""></a><span class="co">#&gt; ── Preprocessor ──────────────────────────────────────────────────────</span></span>
<span id="cb79-11"><a href=""></a><span class="co">#&gt; avg_price_per_room ~ .</span></span>
<span id="cb79-12"><a href=""></a><span class="co">#&gt; </span></span>
<span id="cb79-13"><a href=""></a><span class="co">#&gt; ── Model ─────────────────────────────────────────────────────────────</span></span>
<span id="cb79-14"><a href=""></a><span class="co">#&gt; Boosted Tree Model Specification (regression)</span></span>
<span id="cb79-15"><a href=""></a><span class="co">#&gt; </span></span>
<span id="cb79-16"><a href=""></a><span class="co">#&gt; Main Arguments:</span></span>
<span id="cb79-17"><a href=""></a><span class="co">#&gt;   trees = 1000</span></span>
<span id="cb79-18"><a href=""></a><span class="co">#&gt;   min_n = 7</span></span>
<span id="cb79-19"><a href=""></a><span class="co">#&gt;   tree_depth = 13</span></span>
<span id="cb79-20"><a href=""></a><span class="co">#&gt;   learn_rate = 0.0801616272924067</span></span>
<span id="cb79-21"><a href=""></a><span class="co">#&gt;   loss_reduction = 1.13369097175613e-10</span></span>
<span id="cb79-22"><a href=""></a><span class="co">#&gt;   stop_iter = 17</span></span>
<span id="cb79-23"><a href=""></a><span class="co">#&gt; </span></span>
<span id="cb79-24"><a href=""></a><span class="co">#&gt; Engine-Specific Arguments:</span></span>
<span id="cb79-25"><a href=""></a><span class="co">#&gt;   num_threads = 1</span></span>
<span id="cb79-26"><a href=""></a><span class="co">#&gt; </span></span>
<span id="cb79-27"><a href=""></a><span class="co">#&gt; Computational engine: lightgbm</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">

</div>
</section>
<section id="the-final-fit" class="slide level2">
<h2>The Final Fit</h2>
<p>We can use individual functions:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href=""></a>final_fit <span class="ot">&lt;-</span> final_wflow <span class="sc">%&gt;%</span> <span class="fu">fit</span>(<span class="at">data =</span> hotel_train)</span>
<span id="cb80-2"><a href=""></a></span>
<span id="cb80-3"><a href=""></a><span class="co"># then predict() or augment() </span></span>
<span id="cb80-4"><a href=""></a><span class="co"># then compute metrics</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>Remember that there is also a convenience function to do all of this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">3893</span>)</span>
<span id="cb81-2"><a href=""></a>final_res <span class="ot">&lt;-</span> final_wflow <span class="sc">%&gt;%</span> <span class="fu">last_fit</span>(hotel_split, <span class="at">metrics =</span> reg_metrics)</span>
<span id="cb81-3"><a href=""></a>final_res</span>
<span id="cb81-4"><a href=""></a><span class="co">#&gt; # Resampling results</span></span>
<span id="cb81-5"><a href=""></a><span class="co">#&gt; # Manual resampling </span></span>
<span id="cb81-6"><a href=""></a><span class="co">#&gt; # A tibble: 1 × 6</span></span>
<span id="cb81-7"><a href=""></a><span class="co">#&gt;   splits              id               .metrics         .notes           .predictions         .workflow </span></span>
<span id="cb81-8"><a href=""></a><span class="co">#&gt;   &lt;list&gt;              &lt;chr&gt;            &lt;list&gt;           &lt;list&gt;           &lt;list&gt;               &lt;list&gt;    </span></span>
<span id="cb81-9"><a href=""></a><span class="co">#&gt; 1 &lt;split [3749/1251]&gt; train/test split &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [1,251 × 4]&gt; &lt;workflow&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">

</div>
</section>
<section id="test-set-results" class="slide level2">
<h2>Test Set Results</h2>
<div class="columns">
<div class="column" style="width:65%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href=""></a>final_res <span class="sc">%&gt;%</span> </span>
<span id="cb82-2"><a href=""></a>  <span class="fu">collect_predictions</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb82-3"><a href=""></a>  <span class="fu">cal_plot_regression</span>(</span>
<span id="cb82-4"><a href=""></a>    <span class="at">truth =</span> avg_price_per_room, </span>
<span id="cb82-5"><a href=""></a>    <span class="at">estimate =</span> .pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Test set performance:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href=""></a>final_res <span class="sc">%&gt;%</span> <span class="fu">collect_metrics</span>()</span>
<span id="cb83-2"><a href=""></a><span class="co">#&gt; # A tibble: 2 × 4</span></span>
<span id="cb83-3"><a href=""></a><span class="co">#&gt;   .metric .estimator .estimate .config             </span></span>
<span id="cb83-4"><a href=""></a><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span id="cb83-5"><a href=""></a><span class="co">#&gt; 1 mae     standard       9.68  Preprocessor1_Model1</span></span>
<span id="cb83-6"><a href=""></a><span class="co">#&gt; 2 rsq     standard       0.946 Preprocessor1_Model1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:35%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="part-II_files/figure-revealjs/test-cal-1.svg" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
<p>Recall that resampling predicted the MAE to be 9.599.</p>
<div class="footer">

</div>
</section></section>
<section>
<section id="section-2" class="title-slide slide level1 center">
<h1></h1>
<div class="r-fit-text">
<p>We made it!</p>
</div>
<div class="footer">

</div>
</section>
<section id="resources-to-keep-learning" class="slide level2">
<h2>Resources to keep learning</h2>
<div class="fragment">
<ul>
<li><a href="https://www.tidymodels.org/" class="uri">https://www.tidymodels.org/</a></li>
</ul>
</div>
<div class="fragment">
<ul>
<li><a href="https://www.tmwr.org/" class="uri">https://www.tmwr.org/</a></li>
</ul>
</div>
<div class="fragment">
<ul>
<li><a href="http://www.feat.engineering/" class="uri">http://www.feat.engineering/</a></li>
</ul>
</div>
<div class="fragment">
<ul>
<li><a href="https://smltar.com/" class="uri">https://smltar.com/</a></li>
</ul>
</div>
<div class="fragment">
<div class="footer">

</div>

</div>
</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">
<p>inspired and adapted from <a href="https://tidymodels.org" class="uri">https://tidymodels.org</a> and <a href="https://workshops.tidymodels.org" class="uri">https://workshops.tidymodels.org</a></p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="part-II_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="part-II_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="part-II_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="part-II_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="part-II_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="part-II_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="part-II_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="part-II_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="part-II_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="part-II_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1280,

        height: 720,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
            const codeEl = trigger.previousElementSibling.cloneNode(true);
            for (const childEl of codeEl.children) {
              if (isCodeAnnotation(childEl)) {
                childEl.remove();
              }
            }
            return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>